(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2],{5069:function(e,t,r){Promise.resolve().then(r.bind(r,8628))},8628:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var a=r(7437),n=r(166),i=r(2265),s=r(9376),o=r(970),l=r(1341),c=r(2489),d=r(9322),m=r(1817);let u=[{value:"tactic",label:"Tactic",description:"Set plays and tactical movements"},{value:"skill",label:"Skill",description:"Technical drills and exercises"},{value:"game",label:"Game",description:"Match situations and scenarios"},{value:"other",label:"Other",description:"Other animation types"}],p=[{value:"private",label:"Private",description:"Only you can see this animation"},{value:"link_shared",label:"Link Only",description:"Anyone with the link can view"},{value:"public",label:"Public",description:"Visible in the public gallery"}];function f(e){let{projectName:t,payload:r,onClose:n,onSuccess:s}=e,[o,f]=(0,i.useState)(t||"Untitled Animation"),[x,y]=(0,i.useState)(""),[b,h]=(0,i.useState)("tactic"),[g,j]=(0,i.useState)("private"),[v,I]=(0,i.useState)(""),[F,A]=(0,i.useState)(!1),[N,S]=(0,i.useState)(null),T=async e=>{if(e.preventDefault(),!o.trim()){S("Title is required");return}A(!0),S(null);try{let e=v.split(",").map(e=>e.trim()).filter(e=>e.length>0).slice(0,10),a=await fetch("/api/animations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:o.trim(),description:x.trim()||void 0,animation_type:b,visibility:g,tags:e.length>0?e:void 0,payload:r})});if(!a.ok){var t;let e=await a.json();throw Error((null===(t=e.error)||void 0===t?void 0:t.message)||"Failed to save animation")}let n=await a.json();s(n.id)}catch(e){S(e instanceof Error?e.message:"An error occurred")}finally{A(!1)}};return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:n}),(0,a.jsxs)("div",{className:"relative w-full max-w-lg bg-surface border border-border mx-4 max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-border sticky top-0 bg-surface",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(l.Z,{className:"w-5 h-5 text-primary"}),(0,a.jsx)("h2",{className:"text-lg font-heading font-semibold text-text-primary",children:"Save to Cloud"})]}),(0,a.jsx)("button",{onClick:n,className:"p-1 hover:bg-surface-warm transition-colors","aria-label":"Close modal",children:(0,a.jsx)(c.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("form",{onSubmit:T,className:"p-4",children:[N&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 text-sm flex items-start gap-2",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:N})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{htmlFor:"save-title",className:"block text-sm font-medium text-text-primary mb-1",children:["Title ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",id:"save-title",value:o,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-border bg-surface focus:border-primary focus:outline-none",maxLength:100,placeholder:"Enter a title for your animation",required:!0}),(0,a.jsxs)("p",{className:"text-xs text-text-primary/50 mt-1",children:[o.length,"/100 characters"]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"save-description",className:"block text-sm font-medium text-text-primary mb-1",children:"Description"}),(0,a.jsx)("textarea",{id:"save-description",value:x,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-border bg-surface focus:border-primary focus:outline-none resize-none",rows:3,maxLength:2e3,placeholder:"Describe your animation (optional)"}),(0,a.jsxs)("p",{className:"text-xs text-text-primary/50 mt-1",children:[x.length,"/2000 characters"]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:["Animation Type ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:u.map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>h(e.value),className:"p-3 text-left transition-colors border ".concat(b===e.value?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:[(0,a.jsx)("div",{className:"font-medium text-sm text-text-primary",children:e.label}),(0,a.jsx)("div",{className:"text-xs text-text-primary/60",children:e.description})]},e.value))})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"save-tags",className:"block text-sm font-medium text-text-primary mb-1",children:"Tags"}),(0,a.jsx)("input",{type:"text",id:"save-tags",value:v,onChange:e=>I(e.target.value),className:"w-full px-3 py-2 border border-border bg-surface focus:border-primary focus:outline-none",placeholder:"lineout, scrum, backs (comma-separated)"}),(0,a.jsx)("p",{className:"text-xs text-text-primary/50 mt-1",children:"Up to 10 tags, separated by commas"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Visibility"}),(0,a.jsx)("div",{className:"space-y-2",children:p.map(e=>(0,a.jsxs)("label",{className:"flex items-start p-3 cursor-pointer border transition-colors ".concat(g===e.value?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:[(0,a.jsx)("input",{type:"radio",name:"visibility",value:e.value,checked:g===e.value,onChange:()=>j(e.value),className:"mt-0.5 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-text-primary",children:e.label}),(0,a.jsx)("div",{className:"text-xs text-text-primary/70",children:e.description})]})]},e.value))})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:n,className:"flex-1 px-4 py-2 border border-border text-text-primary font-medium hover:bg-surface-warm transition-colors",disabled:F,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-primary text-text-inverse font-medium hover:bg-primary/90 transition-colors disabled:opacity-50",disabled:F,children:F?(0,a.jsxs)("span",{className:"inline-flex items-center justify-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):(0,a.jsxs)("span",{className:"inline-flex items-center justify-center gap-2",children:[(0,a.jsx)(l.Z,{className:"w-4 h-4"}),"Save to Cloud"]})})]})]})]})]})}var x=r(105),y=r(4438);let b=(0,n.default)(()=>Promise.all([r.e(364),r.e(28)]).then(r.bind(r,6028)),{loadableGenerated:{webpack:()=>[6028]},ssr:!1,loading:()=>(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-background",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-text-primary",children:"Loading editor..."})]})})});function h(){let e=(0,s.useRouter)(),[t,r]=(0,i.useState)(null),[n,l]=(0,i.useState)(!0),[c,d]=(0,i.useState)(!1),m=(0,x.i)(e=>e.project);(0,i.useEffect)(()=>{let e=(0,o.W)();e.auth.getUser().then(e=>{let{data:{user:t}}=e;r(t),l(!1)});let{data:{subscription:t}}=e.auth.onAuthStateChange((e,t)=>{var a;r(null!==(a=null==t?void 0:t.user)&&void 0!==a?a:null)});return()=>t.unsubscribe()},[]);let u=(0,i.useCallback)(()=>{if(!t){e.push("/login?redirect=/app");return}d(!0)},[t,e]),p=(0,i.useCallback)(e=>{d(!1),y.Am.success("Animation saved to cloud!"),console.log("Saved animation ID:",e)},[]),h=(0,i.useCallback)(()=>m?{version:"1.0",name:m.name,sport:m.sport,frames:m.frames,settings:m.settings}:null,[m]);if(n)return(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-background",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-text-primary",children:"Loading..."})]})});let g=h();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b,{isAuthenticated:!!t,onSaveToCloud:u}),c&&g&&(0,a.jsx)(f,{projectName:(null==m?void 0:m.name)||"Untitled Animation",payload:g,onClose:()=>d(!1),onSuccess:p})]})}},970:function(e,t,r){"use strict";r.d(t,{W:function(){return n}});var a=r(1259);function n(){return(0,a.createBrowserClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP")}},5060:function(e,t,r){"use strict";r.d(t,{q:function(){return a}});let a={colors:{primary:"#1A3D1A",background:"#F8F9FA",surface:"#FFFFFF",surfaceWarm:"#F9FAFB",border:"#1A3D1A",textPrimary:"#111827",textInverse:"#F8F9FA",accentWarm:"#D97706",attack:["#2563EB","#10B981","#06B6D4","#8B5CF6"],defense:["#DC2626","#EA580C","#F59E0B","#EF4444"],neutral:["#FFFFFF","#8B4513","#FFD700","#FF6B35"],annotation:"#FACC15"},typography:{fontMono:"'JetBrains Mono', 'Fira Code', monospace",fontHeading:"'Inter', 'Helvetica Neue', sans-serif",fontBody:"'Inter', system-ui, sans-serif"},spacing:{unit:4,borderRadius:0,borderWidth:1}}},525:function(e,t,r){"use strict";r.d(t,{a:function(){return a}});let a={PROJECT:{NAME_MAX_LENGTH:100,MAX_FRAMES:50,GUEST_MAX_FRAMES:10,SUPPORTED_VERSIONS:["1.0"]},ENTITY:{LABEL_MAX_LENGTH:10,LABEL_PATTERN:/^[\w\s\-\.]*$/,COLOR_PATTERN:/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/,COORD_MIN:0,COORD_MAX:2e3},FRAME:{DURATION_MIN_MS:100,DURATION_MAX_MS:1e4,DURATION_DEFAULT_MS:2e3},ANNOTATION:{MAX_POINTS:100},EXPORT:{TIMEOUT_BUFFER_MS:5e3,MAX_DURATION_MS:3e5,RESOLUTIONS:{"720p":{width:1280,height:720},"1080p":{width:1920,height:1080}}},STORAGE:{MAX_SIZE_BYTES:5242880,AUTOSAVE_INTERVAL_MS:3e4},RATE_LIMITS:{EXPORT_COOLDOWN_MS:5e3,SAVE_COOLDOWN_MS:2e3}}},105:function(e,t,r){"use strict";r.d(t,{i:function(){return x}});var a=r(3011),n=r(6885),i=r(4438),s=r(5060),o=r(525);let l=e=>e.length>=1&&e.length<=o.a.PROJECT.NAME_MAX_LENGTH,c=e=>o.a.ENTITY.COLOR_PATTERN.test(e),d=e=>e.length<=o.a.ENTITY.LABEL_MAX_LENGTH&&o.a.ENTITY.LABEL_PATTERN.test(e),m=(e,t)=>e>=o.a.ENTITY.COORD_MIN&&e<=o.a.ENTITY.COORD_MAX&&t>=o.a.ENTITY.COORD_MIN&&t<=o.a.ENTITY.COORD_MAX,u=e=>Number.isInteger(e)&&e>=o.a.FRAME.DURATION_MIN_MS&&e<=o.a.FRAME.DURATION_MAX_MS,p=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),f=e=>{let t=[],r=[];if(!e||"object"!=typeof e)return t.push("Invalid project data: expected an object"),{success:!1,errors:t,warnings:r};if("string"!=typeof e.version&&t.push('Missing or invalid "version" field'),"string"==typeof e.id&&p(e.id)||t.push('Missing or invalid "id" field (must be UUID)'),"string"==typeof e.name&&l(e.name)||t.push('Missing or invalid "name" field'),["rugby-union","rugby-league","soccer","american-football"].includes(e.sport)||t.push('Invalid "sport" field'),"string"!=typeof e.createdAt&&t.push('Missing or invalid "createdAt" field'),"string"!=typeof e.updatedAt&&t.push('Missing or invalid "updatedAt" field'),Array.isArray(e.frames)?(0===e.frames.length&&t.push("Project must have at least one frame"),e.frames.length>o.a.PROJECT.MAX_FRAMES&&t.push("Too many frames (max: ".concat(o.a.PROJECT.MAX_FRAMES,")")),e.frames.forEach((e,a)=>{if(!e||"object"!=typeof e){t.push("Frame ".concat(a,": invalid frame object"));return}"string"==typeof e.id&&p(e.id)||t.push("Frame ".concat(a,": invalid id")),("number"!=typeof e.index||e.index!==a)&&t.push("Frame ".concat(a,": invalid index (expected ").concat(a,")")),"number"==typeof e.duration&&u(e.duration)||t.push("Frame ".concat(a,": invalid duration")),e.entities&&"object"==typeof e.entities?Object.entries(e.entities).forEach(e=>{let[n,i]=e;if(!i||"object"!=typeof i){t.push("Frame ".concat(a,", Entity ").concat(n,": invalid entity object"));return}"string"==typeof i.id&&p(i.id)||t.push("Frame ".concat(a,", Entity ").concat(n,": invalid id")),["player","ball","cone","marker"].includes(i.type)||t.push("Frame ".concat(a,", Entity ").concat(n,": invalid type")),"number"==typeof i.x&&"number"==typeof i.y&&m(i.x,i.y)||t.push("Frame ".concat(a,", Entity ").concat(n,": invalid coordinates")),"string"==typeof i.color&&c(i.color)||r.push("Frame ".concat(a,", Entity ").concat(n,": invalid color format")),"string"==typeof i.label&&d(i.label)||r.push("Frame ".concat(a,", Entity ").concat(n,": invalid label")),["attack","defense","neutral"].includes(i.team)||t.push("Frame ".concat(a,", Entity ").concat(n,": invalid team"))}):t.push("Frame ".concat(a,": invalid entities object")),Array.isArray(e.annotations)||t.push("Frame ".concat(a,": invalid annotations (must be array)"))})):t.push('Missing or invalid "frames" field (must be array)'),e.settings&&"object"==typeof e.settings){let r=e.settings;"boolean"!=typeof r.showGrid&&t.push("Settings: invalid showGrid"),"number"!=typeof r.gridSpacing&&t.push("Settings: invalid gridSpacing"),"number"!=typeof r.defaultTransitionDuration&&t.push("Settings: invalid defaultTransitionDuration"),["720p","1080p"].includes(r.exportResolution)||t.push("Settings: invalid exportResolution")}else t.push('Missing or invalid "settings" object');return{success:0===t.length,errors:t,warnings:r}},x=(0,a.U)()((0,n.mW)(e=>({project:null,currentFrameIndex:0,isPlaying:!1,isDirty:!1,playbackSpeed:1,loopPlayback:!1,playbackPosition:null,newProject:()=>e(()=>{let e=crypto.randomUUID(),t=crypto.randomUUID(),r=new Date().toISOString();return{project:{version:"1.0",id:e,name:"Untitled Play",sport:"rugby-union",createdAt:r,updatedAt:r,frames:[{id:t,index:0,duration:2e3,entities:{},annotations:[]}],settings:{showGrid:!0,gridSpacing:50,defaultTransitionDuration:2e3,exportResolution:"720p"}},currentFrameIndex:0,isPlaying:!1,isDirty:!1,playbackSpeed:1,loopPlayback:!1}}),loadProject:t=>{let r={success:!1,errors:[],warnings:[]};return e(e=>{let a=f(t);return a.success?(r={success:!0,errors:[],warnings:a.warnings},{...e,project:t,currentFrameIndex:0,isPlaying:!1,isDirty:!1,playbackSpeed:1,loopPlayback:!1}):(r={success:!1,errors:a.errors,warnings:a.warnings},e)}),r},loadFromSharePayload:t=>e(e=>{let r=new Date().toISOString(),a=crypto.randomUUID(),n=[],i={};t.entities.forEach(e=>{i[e.id]={id:e.id,type:e.type,team:"defence"===e.team?"defense":e.team,color:"attack"===e.team?s.q.colors.attack[0]:"defence"===e.team?s.q.colors.defense[0]:"#ffffff",label:"",x:e.x,y:e.y}});for(let e=0;e<t.frames.length;e++){let r=t.frames[e],a=t.frames[e+1];r.updates&&r.updates.forEach(e=>{i[e.id]&&(i[e.id]={...i[e.id],x:e.x,y:e.y})});let s=a?(a.t-r.t)*1e3:2e3;n.push({id:crypto.randomUUID(),index:e,duration:s,entities:{...i},annotations:[]})}return 0===n.length&&n.push({id:crypto.randomUUID(),index:0,duration:2e3,entities:{...i},annotations:[]}),{...e,project:{version:"1.0",id:a,name:"Shared Animation",sport:"rugby-union",createdAt:r,updatedAt:r,frames:n,settings:{showGrid:!1,gridSpacing:50,defaultTransitionDuration:1e3,exportResolution:"720p"}},currentFrameIndex:0,isPlaying:!1,isDirty:!1,playbackSpeed:1,loopPlayback:!0}}),saveProject:()=>{let t="";return e(e=>{if(!e.project)return e;let r={...e.project,updatedAt:new Date().toISOString()};return t=JSON.stringify(r,null,2),{...e,project:r,isDirty:!1}}),t},updateProjectSettings:t=>e(e=>{if(!e.project)return e;let r=new Date().toISOString();return{project:{...e.project,...void 0!==t.name&&{name:t.name},...void 0!==t.sport&&{sport:t.sport},updatedAt:r,settings:{...e.project.settings,...void 0!==t.showGrid&&{showGrid:t.showGrid},...void 0!==t.gridSpacing&&{gridSpacing:t.gridSpacing},...void 0!==t.defaultTransitionDuration&&{defaultTransitionDuration:t.defaultTransitionDuration},...void 0!==t.exportResolution&&{exportResolution:t.exportResolution}}},isDirty:!0}}),setCurrentFrame:t=>e(e=>!e.project||t<0||t>=e.project.frames.length?e:{...e,currentFrameIndex:t}),addFrame:()=>e(e=>{if(!e.project)return e;if(e.project.frames.length>=o.a.PROJECT.MAX_FRAMES)return console.warn("Maximum frames reached (".concat(o.a.PROJECT.MAX_FRAMES,")")),i.Am.error("Maximum frames reached. You can have up to ".concat(o.a.PROJECT.MAX_FRAMES," frames in a project.")),e;let t=e.project.frames[e.currentFrameIndex],r={id:crypto.randomUUID(),index:e.currentFrameIndex+1,duration:e.project.settings.defaultTransitionDuration,entities:{...t.entities},annotations:[]},a=e.project.frames.map(t=>({...t,index:t.index>e.currentFrameIndex?t.index+1:t.index}));return a.splice(e.currentFrameIndex+1,0,r),{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:a},currentFrameIndex:e.currentFrameIndex+1,isDirty:!0}}),removeFrame:t=>e(e=>{if(!e.project||e.project.frames.length<=1)return e;let r=e.project.frames.findIndex(e=>e.id===t);if(-1===r)return e;let a=e.project.frames.filter((e,t)=>t!==r).map((e,t)=>({...e,index:t})),n=e.currentFrameIndex;return r<e.currentFrameIndex?n=e.currentFrameIndex-1:r===e.currentFrameIndex&&r===e.project.frames.length-1&&(n=e.currentFrameIndex-1),{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:a},currentFrameIndex:n,isDirty:!0}}),duplicateFrame:t=>e(e=>{if(!e.project)return e;let r=e.project.frames.findIndex(e=>e.id===t);if(-1===r)return e;let a=e.project.frames[r],n={id:crypto.randomUUID(),index:r+1,duration:a.duration,entities:{...a.entities},annotations:[...a.annotations]},i=e.project.frames.map(e=>({...e,index:e.index>r?e.index+1:e.index}));return i.splice(r+1,0,n),{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:i},isDirty:!0}}),updateFrame:(t,r)=>e(e=>{if(!e.project)return e;let a=e.project.frames.findIndex(e=>e.id===t);if(-1===a)return e;let n=e.project.frames.map((e,t)=>{if(t!==a)return e;let n={...e};return void 0!==r.duration&&(n.duration=Math.max(o.a.FRAME.DURATION_MIN_MS,Math.min(o.a.FRAME.DURATION_MAX_MS,r.duration))),n});return{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:n},isDirty:!0}}),addEntity:t=>{let r="";return e(e=>{var a,n,i;if(!e.project||e.currentFrameIndex<0||e.currentFrameIndex>=e.project.frames.length)return e;r=crypto.randomUUID();let l=null!==(a=t.team)&&void 0!==a?a:"neutral",c=null!==(n=t.color)&&void 0!==n?n:s.q.colors[l][0],d=null!==(i=t.label)&&void 0!==i?i:"",m=(e,t,r)=>Math.max(t,Math.min(r,e)),u=m(t.x,o.a.ENTITY.COORD_MIN,o.a.ENTITY.COORD_MAX),p=m(t.y,o.a.ENTITY.COORD_MIN,o.a.ENTITY.COORD_MAX),f={id:r,type:t.type,x:u,y:p,color:c,label:d,team:l},x={...e.project.frames[e.currentFrameIndex].entities,[r]:f};return{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:e.project.frames.map((t,r)=>r===e.currentFrameIndex?{...t,entities:x}:t)},isDirty:!0}}),r},updateEntity:(t,r)=>e(e=>{if(!e.project||e.currentFrameIndex<0||e.currentFrameIndex>=e.project.frames.length)return e;let a=e.project.frames[e.currentFrameIndex];if(!a.entities[t])return e;let n=a.entities[t],i={},s=(e,t,r)=>Math.max(t,Math.min(r,e));void 0!==r.x&&(i.x=s(r.x,o.a.ENTITY.COORD_MIN,o.a.ENTITY.COORD_MAX)),void 0!==r.y&&(i.y=s(r.y,o.a.ENTITY.COORD_MIN,o.a.ENTITY.COORD_MAX)),void 0!==r.color&&(c(r.color)||console.warn("Invalid hex color format: ".concat(r.color,". Allowing anyway.")),i.color=r.color),void 0!==r.label&&(d(r.label)||console.warn("Invalid entity label: ".concat(r.label,". Allowing anyway.")),i.label=r.label),void 0!==r.team&&(i.team=r.team),void 0!==r.parentId&&(i.parentId=null===r.parentId?void 0:r.parentId);let l={...n,...i},m={...a.entities,[t]:l};return{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:e.project.frames.map((t,r)=>r===e.currentFrameIndex?{...t,entities:m}:t)},isDirty:!0}}),removeEntity:t=>e(e=>{if(!e.project||e.currentFrameIndex<0||e.currentFrameIndex>=e.project.frames.length)return e;let r=e.project.frames[e.currentFrameIndex];if(!r.entities[t])return e;let{[t]:a,...n}=r.entities;return{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:e.project.frames.map((t,r)=>r===e.currentFrameIndex?{...t,entities:n}:t)},isDirty:!0}}),removeEntityGlobally:()=>{},propagateEntity:()=>{},addAnnotation:t=>{let r="";return e(e=>{if(!e.project||e.currentFrameIndex<0||e.currentFrameIndex>=e.project.frames.length)return e;r=crypto.randomUUID();let a=e.project.frames[e.currentFrameIndex],n={id:r,type:t.type,points:t.points,color:t.color,startFrameId:a.id,endFrameId:a.id},i=[...a.annotations,n];return{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:e.project.frames.map((t,r)=>r===e.currentFrameIndex?{...t,annotations:i}:t)},isDirty:!0}}),r},updateAnnotation:(t,r)=>e(e=>{if(!e.project||e.currentFrameIndex<0||e.currentFrameIndex>=e.project.frames.length)return e;let a=e.project.frames[e.currentFrameIndex],n=a.annotations.findIndex(e=>e.id===t);if(-1===n)return e;let i=a.annotations.map((e,t)=>t!==n?e:{...e,...void 0!==r.points&&{points:r.points},...void 0!==r.color&&{color:r.color},...void 0!==r.startFrameId&&{startFrameId:r.startFrameId},...void 0!==r.endFrameId&&{endFrameId:r.endFrameId}});return{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:e.project.frames.map((t,r)=>r===e.currentFrameIndex?{...t,annotations:i}:t)},isDirty:!0}}),removeAnnotation:t=>e(e=>{if(!e.project||e.currentFrameIndex<0||e.currentFrameIndex>=e.project.frames.length)return e;let r=e.project.frames[e.currentFrameIndex].annotations.filter(e=>e.id!==t);return{...e,project:{...e.project,updatedAt:new Date().toISOString(),frames:e.project.frames.map((t,a)=>a===e.currentFrameIndex?{...t,annotations:r}:t)},isDirty:!0}}),play:()=>e(e=>({...e,isPlaying:!0})),pause:()=>e(e=>({...e,isPlaying:!1,playbackPosition:null})),reset:()=>e(e=>({...e,currentFrameIndex:0,isPlaying:!1,playbackPosition:null})),setPlaybackSpeed:t=>e(e=>({...e,playbackSpeed:t})),toggleLoop:()=>e(e=>({...e,loopPlayback:!e.loopPlayback})),setPlaybackPosition:t=>e(e=>({...e,playbackPosition:t}))}),{name:"ProjectStore"}))}},function(e){e.O(0,[259,594,971,734,744],function(){return e(e.s=5069)}),_N_E=e.O()}]);