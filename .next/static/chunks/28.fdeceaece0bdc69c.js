"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{6028:function(e,t,r){r.r(t),r.d(t,{Editor:function(){return ez},default:function(){return eM}});var a=r(7437),o=r(2265),n=r(8514);let l=o.forwardRef((e,t)=>{let{width:r,height:o,onCanvasClick:l,children:s}=e;return(0,a.jsx)(n.Hf,{ref:t,width:r,height:o,pixelRatio:window.devicePixelRatio||1,onClick:e=>{e.target===e.target.getStage()&&l&&l()},style:{cursor:"default",display:"block"},children:s})}),s=e=>{let{sport:t,width:r,height:l}=e,[s,i]=(0,o.useState)(void 0),[c,d]=(0,o.useState)(null);return((0,o.useEffect)(()=>{let e=new window.Image,r="/assets/fields/".concat(t,".svg");return e.src=r,e.onload=()=>{i(e),d(null)},e.onerror=()=>{d("Failed to load field asset: ".concat(r)),console.error("Failed to load field asset: ".concat(r))},()=>{e.onload=null,e.onerror=null}},[t]),c)?(0,a.jsx)(n.mh,{listening:!1,children:(0,a.jsx)(n.xv,{text:c,x:r/2,y:l/2,fontSize:14,fill:"red",align:"center",offsetX:100})}):s?(0,a.jsx)(n.mh,{listening:!1,children:(0,a.jsx)(n.Ee,{image:s,width:r,height:l,listening:!1})}):(0,a.jsx)(n.mh,{listening:!1})};var i=r(5060);let c=e=>{let{width:t,height:r,gridSize:o=100,visible:l=!0}=e;if(!l)return null;let s=[];for(let e=0;e<=t;e+=o)s.push((0,a.jsx)(n.x1,{points:[e,0,e,r],stroke:i.q.colors.background,strokeWidth:1,opacity:.3,listening:!1},"v-".concat(e)));for(let e=0;e<=r;e+=o)s.push((0,a.jsx)(n.x1,{points:[0,e,t,e],stroke:i.q.colors.background,strokeWidth:1,opacity:.3,listening:!1},"h-".concat(e)));return(0,a.jsx)(n.mh,{listening:!1,children:s})},d=e=>{let{entity:t,isSelected:r,draggable:l,onSelect:s,onDragEnd:c,onDoubleClick:d,onContextMenu:u,opacity:m=1}=e,x=(0,o.useRef)(null),p=(0,o.useRef)(0),f=(0,o.useRef)({x:0,y:0}),h=e=>{let t=Date.now(),r=t-p.current,a=e.target.getStage().getPointerPosition(),o=a.x,n=a.y,l=o-f.current.x,i=n-f.current.y;r<500&&10>Math.sqrt(l*l+i*i)?(d(),p.current=0):(s(),p.current=t,f.current={x:o,y:n})},g=(e=>{switch(e){case"player":default:return 20;case"ball":return 12;case"cone":return 15;case"marker":return 10}})(t.type),v=(()=>{if(t.color)return t.color;switch(t.type){case"ball":return"#854D0E";case"cone":return"#EA580C";case"marker":default:return i.q.colors.primary;case"player":return({attack:i.q.colors.attack[0],defense:i.q.colors.defense[0],neutral:i.q.colors.neutral[0]})[t.team]||i.q.colors.primary}})(),b="player"===t.type&&t.label;return(0,a.jsxs)(n.ZA,{ref:x,id:t.id,x:t.x,y:t.y,draggable:l,onClick:h,onTap:h,onDblClick:d,onDblTap:d,onContextMenu:e=>{e.evt.preventDefault();let t=e.target.getStage().getPointerPosition();u({x:t.x,y:t.y})},onDragEnd:e=>{let t=e.target,r=t.x(),a=t.y(),o=Math.max(0,Math.min(r,2e3)),n=Math.max(0,Math.min(a,2e3));t.x(o),t.y(n),c(o,n)},children:["ball"===t.type?(0,a.jsx)(n.Pj,{radiusX:18,radiusY:12,fill:v,stroke:r?i.q.colors.primary:"#1A3D1A",strokeWidth:r?3:1,shadowEnabled:!1,opacity:m}):(0,a.jsx)(n.Cd,{radius:g,fill:v,stroke:r?i.q.colors.primary:void 0,strokeWidth:r?3:0,shadowEnabled:!1,opacity:m}),b&&(0,a.jsx)(n.xv,{text:t.label,fontSize:14,fontFamily:i.q.typography.fontBody,fill:i.q.colors.textInverse,align:"center",verticalAlign:"middle",width:2*g,height:2*g,offsetX:g,offsetY:g,listening:!1,opacity:m})]})},u=e=>{let{entities:t,selectedEntityId:r,onEntitySelect:l,onEntityMove:s,onEntityDoubleClick:i,onEntityContextMenu:c,interactive:u,playbackPosition:m,frames:x}=e,p=e=>e.map(t=>{if(t.parentId){let r=e.find(e=>e.id===t.parentId);if(r)return{...t,x:r.x,y:r.y}}return t}),f=(0,o.useMemo)(()=>{if(!m||!x.length)return p(t.map(e=>({...e,opacity:1})));let e=x[m.fromFrameIndex],r=x[m.toFrameIndex];if(!e||!r)return p(t.map(e=>({...e,opacity:1})));let{progress:a}=m;return p(t.map(t=>{let o=e.entities[t.id],n=r.entities[t.id];return o&&n?{...t,x:o.x+(n.x-o.x)*a,y:o.y+(n.y-o.y)*a,opacity:1}:o&&!n?{...t,x:o.x,y:o.y,opacity:1-a}:!o&&n?{...t,x:n.x,y:n.y,opacity:a}:{...t,opacity:1}}))},[t,m,x]);return(0,a.jsx)(n.mh,{listening:u,children:f.map(e=>{var t;return(0,a.jsx)(d,{entity:e,isSelected:r===e.id,draggable:u&&!e.parentId,onSelect:()=>l(e.id),onDragEnd:(t,r)=>s(e.id,t,r),onDoubleClick:()=>i(e.id),onContextMenu:t=>c(e.id,t),opacity:null!==(t=e.opacity)&&void 0!==t?t:1},e.id)})})};function m(e){let{initialValue:t,position:r,onConfirm:n,onCancel:l,maxLength:s=10}=e,[i,c]=(0,o.useState)(t),d=(0,o.useRef)(null);return(0,o.useEffect)(()=>{d.current&&(d.current.focus(),d.current.select())},[]),(0,a.jsx)("div",{className:"fixed z-50",style:{left:"".concat(r.x,"px"),top:"".concat(r.y,"px")},children:(0,a.jsx)("input",{ref:d,type:"text",value:i,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),n(i)):"Escape"===e.key&&(e.preventDefault(),l())},onBlur:()=>{n(i)},maxLength:s,className:"w-20 px-2 py-1 text-sm text-center font-mono border-2 border-pitch-green bg-white focus:outline-none focus:ring-2 focus:ring-pitch-green"})})}var x=r(105),p=r(3011),f=r(6885);let h=(0,p.U)()((0,f.mW)(e=>({selectedEntityId:null,selectedAnnotationId:null,drawingMode:"none",showGhosts:!1,showGrid:!1,activeSidebarPanel:"entities",isLoading:{save:!1,load:!1},exportDialog:{isOpen:!1,progress:0,status:"idle"},unsavedChangesDialog:{isOpen:!1,pendingAction:null},selectEntity:t=>e(e=>({...e,selectedEntityId:t})),deselectAll:()=>e(e=>({...e,selectedEntityId:null})),toggleGhosts:()=>e(e=>({...e,showGhosts:!e.showGhosts})),toggleGrid:()=>e(e=>({...e,showGrid:!e.showGrid})),setSidebarPanel:t=>e(e=>({...e,activeSidebarPanel:t})),setLoadingState:(t,r)=>e(e=>({...e,isLoading:{...e.isLoading,[t]:r}})),startExport:()=>e(e=>({...e,exportDialog:{...e.exportDialog,isOpen:!0,progress:0,status:"preparing"}})),setExportProgress:t=>e(e=>({...e,exportDialog:{...e.exportDialog,progress:t}})),completeExport:t=>e(e=>({...e,exportDialog:{...e.exportDialog,status:t.success?"complete":"error",error:t.error}})),closeExportDialog:()=>e(e=>({...e,exportDialog:{isOpen:!1,progress:0,status:"idle"}})),showUnsavedChangesDialog:t=>e(e=>({...e,unsavedChangesDialog:{isOpen:!0,pendingAction:t}})),confirmPendingAction:()=>e(e=>({...e,unsavedChangesDialog:{isOpen:!1,pendingAction:null}})),cancelPendingAction:()=>e(e=>({...e,unsavedChangesDialog:{isOpen:!1,pendingAction:null}})),setDrawingMode:t=>e(e=>({...e,drawingMode:t,selectedEntityId:"none"!==t?null:e.selectedEntityId})),selectAnnotation:t=>e(e=>({...e,selectedAnnotationId:t,selectedEntityId:null!==t?null:e.selectedEntityId}))}),{name:"UIStore"})),g=()=>{let{project:e,currentFrameIndex:t}=(0,x.i)(),{showGhosts:r}=h();if(!r||!e||0===t)return(0,a.jsx)(n.mh,{listening:!1});let l=e.frames[t-1];if(!l)return(0,a.jsx)(n.mh,{listening:!1});let s=Object.values(l.entities);return(0,a.jsx)(n.mh,{listening:!1,children:s.map(e=>(0,a.jsx)(o.Fragment,{children:function(e){let{type:t,x:r,y:o,color:l,label:s}=e;return"ball"===t?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(n.Pj,{x:r,y:o,radiusX:18,radiusY:12,fill:l,opacity:.3})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.Cd,{x:r,y:o,radius:20,fill:l,stroke:"#000",strokeWidth:1,opacity:.3}),(0,a.jsx)(n.xv,{x:r-15,y:o-8,width:30,text:s,fontSize:14,fontFamily:"monospace",fontStyle:"bold",fill:"#fff",align:"center",opacity:.3})]})}(e)},"ghost-".concat(e.id)))})},v=e=>{let{annotations:t,selectedAnnotationId:r,onAnnotationSelect:o,onContextMenu:l,interactive:s,currentFrameId:i,frameIds:c}=e,d=t.filter(e=>{let t=c.indexOf(i),r=c.indexOf(e.startFrameId),a=c.indexOf(e.endFrameId);return t>=r&&t<=a}),u=(e,t)=>{t.evt.preventDefault();let r=t.target.getStage().getPointerPosition();l(e,{x:r.x,y:r.y})};return(0,a.jsx)(n.mh,{listening:s,children:d.map(e=>{let t=r===e.id?4:3,[l,s,i,c]=e.points;return"arrow"===e.type?(0,a.jsx)(n.Eh,{points:[l,s,i,c],stroke:e.color,strokeWidth:t,fill:e.color,pointerLength:12,pointerWidth:12,lineCap:"round",lineJoin:"round",onClick:()=>o(e.id),onTap:()=>o(e.id),onContextMenu:t=>u(e.id,t),hitStrokeWidth:20},e.id):(0,a.jsx)(n.x1,{points:[l,s,i,c],stroke:e.color,strokeWidth:t,lineCap:"round",lineJoin:"round",onClick:()=>o(e.id),onTap:()=>o(e.id),onContextMenu:t=>u(e.id,t),hitStrokeWidth:20},e.id)})})},b=e=>{let{drawingMode:t,defaultColor:r,onDrawingComplete:l,interactive:s,width:i,height:c}=e,[d,u]=(0,o.useState)(!1),[m,x]=(0,o.useState)(null),[p,f]=(0,o.useState)(null);if("none"===t||!s)return null;let h=()=>{if(!d||!m||!p){u(!1);return}let e=p.x-m.x,r=p.y-m.y;Math.sqrt(e*e+r*r)>=10&&l([m.x,m.y,p.x,p.y],t),u(!1),x(null),f(null)},g=m&&p?[m.x,m.y,p.x,p.y]:[];return(0,a.jsxs)(n.mh,{children:[(0,a.jsx)(n.UL,{x:0,y:0,width:i,height:c,fill:"transparent",onMouseDown:e=>{let t=e.target.getStage();if(!t)return;let r=t.getPointerPosition();r&&(u(!0),x({x:r.x,y:r.y}),f({x:r.x,y:r.y}))},onMouseMove:e=>{if(!d)return;let t=e.target.getStage();if(!t)return;let r=t.getPointerPosition();r&&f({x:r.x,y:r.y})},onMouseUp:h,onMouseLeave:h}),d&&m&&p&&("arrow"===t?(0,a.jsx)(n.Eh,{points:g,stroke:r,strokeWidth:3,fill:r,pointerLength:12,pointerWidth:12,lineCap:"round",lineJoin:"round",opacity:.7,listening:!1}):(0,a.jsx)(n.x1,{points:g,stroke:r,strokeWidth:3,lineCap:"round",lineJoin:"round",opacity:.7,listening:!1}))]})};var y=r(7053),w=r(535),j=r(1994),N=r(3335);function C(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,N.m6)((0,j.W)(t))}let k=(0,w.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-none text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-[var(--color-accent-warm)] text-white shadow hover:bg-[#B45309]",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-[var(--color-border)] bg-[var(--color-surface)] shadow-sm hover:bg-[var(--color-accent-warm)] hover:text-white",secondary:"bg-[var(--color-surface-warm)] text-[var(--color-text-primary)] shadow-sm hover:bg-[var(--color-accent-warm)] hover:text-white",ghost:"hover:bg-[var(--color-accent-warm)] hover:text-white",link:"text-[var(--color-accent-warm)] underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-none px-3 text-xs",lg:"h-10 rounded-none px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),E=o.forwardRef((e,t)=>{let{className:r,variant:o,size:n,asChild:l=!1,...s}=e,i=l?y.g7:"button";return(0,a.jsx)(i,{className:C(k({variant:o,size:n,className:r})),ref:t,...s})});function S(e){let{onAddAttackPlayer:t,onAddDefensePlayer:r,onAddBall:o,onAddCone:n,onAddMarker:l,drawingMode:s,onDrawingModeChange:i}=e;return(0,a.jsxs)("div",{className:"p-4 border-b border-[var(--color-surface-warm)]",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-pitch-green mb-2",children:"Entities"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(E,{variant:"default",size:"sm",onClick:t,className:"justify-start","aria-label":"Add attack player",children:"+ Attack Player"}),(0,a.jsx)(E,{variant:"default",size:"sm",onClick:r,className:"justify-start","aria-label":"Add defense player",children:"+ Defense Player"}),(0,a.jsx)(E,{variant:"outline",size:"sm",onClick:o,className:"justify-start","aria-label":"Add ball",children:"+ Ball"}),(0,a.jsx)(E,{variant:"outline",size:"sm",onClick:n,className:"justify-start","aria-label":"Add cone",children:"+ Cone"}),(0,a.jsx)(E,{variant:"outline",size:"sm",onClick:l,className:"justify-start","aria-label":"Add marker",children:"+ Marker"})]}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-pitch-green mt-4 mb-2",children:"Annotations"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(E,{variant:"arrow"===s?"default":"outline",size:"sm",onClick:()=>{i("arrow"===s?"none":"arrow")},className:"flex-1","aria-label":"arrow"===s?"Disable arrow drawing":"Enable arrow drawing",children:"Arrow →"}),(0,a.jsx)(E,{variant:"line"===s?"default":"outline",size:"sm",onClick:()=>{i("line"===s?"none":"line")},className:"flex-1","aria-label":"line"===s?"Disable line drawing":"Enable line drawing",children:"Line —"})]}),"none"!==s&&(0,a.jsx)("p",{className:"text-xs text-[var(--color-text-primary)] opacity-60 mt-2 font-mono",children:"Click and drag on canvas to draw"})]})}E.displayName="Button";let R=o.forwardRef((e,t)=>{let{className:r,type:o,...n}=e;return(0,a.jsx)("input",{type:o,className:C("flex h-9 w-full rounded-none border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});function A(e){let{value:t,onChange:r,label:o}=e,n=[...i.q.colors.attack,...i.q.colors.defense,...i.q.colors.neutral];return(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[o&&(0,a.jsx)("label",{className:"text-xs font-semibold text-[var(--color-text-primary)]",children:o}),(0,a.jsx)("div",{className:"grid grid-cols-6 gap-2",children:n.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>r(e),className:"w-8 h-8 border-2 transition-all hover:scale-110",style:{backgroundColor:e,borderColor:t===e?i.q.colors.primary:"#E5E7EB",borderWidth:t===e?"3px":"1px"},title:e},e))})]})}R.displayName="Input";var D=r(1384),F=r(875),P=r(2135),I=r(401);let L=D.fC;D.ZA;let _=D.B4,z=o.forwardRef((e,t)=>{let{className:r,children:o,...n}=e;return(0,a.jsxs)(D.xz,{ref:t,className:C("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-none border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...n,children:[o,(0,a.jsx)(D.JO,{asChild:!0,children:(0,a.jsx)(F.Z,{className:"h-4 w-4 opacity-50"})})]})});z.displayName=D.xz.displayName;let M=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(D.u_,{ref:t,className:C("flex cursor-default items-center justify-center py-1",r),...o,children:(0,a.jsx)(P.Z,{className:"h-4 w-4"})})});M.displayName=D.u_.displayName;let T=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(D.$G,{ref:t,className:C("flex cursor-default items-center justify-center py-1",r),...o,children:(0,a.jsx)(F.Z,{className:"h-4 w-4"})})});T.displayName=D.$G.displayName;let O=o.forwardRef((e,t)=>{let{className:r,children:o,position:n="popper",...l}=e;return(0,a.jsx)(D.h_,{children:(0,a.jsxs)(D.VY,{ref:t,className:C("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:n,...l,children:[(0,a.jsx)(M,{}),(0,a.jsx)(D.l_,{className:C("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:o}),(0,a.jsx)(T,{})]})})});O.displayName=D.VY.displayName,o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(D.__,{ref:t,className:C("px-2 py-1.5 text-sm font-semibold",r),...o})}).displayName=D.__.displayName;let U=o.forwardRef((e,t)=>{let{className:r,children:o,...n}=e;return(0,a.jsxs)(D.ck,{ref:t,className:C("relative flex w-full cursor-default select-none items-center rounded-none py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...n,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(D.wU,{children:(0,a.jsx)(I.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(D.eT,{children:o})]})});function q(e){let{entity:t,onUpdate:r}=e,{project:o,currentFrameIndex:n,updateAnnotation:l}=(0,x.i)(),{selectedAnnotationId:s}=h(),i=null==o?void 0:o.frames[n],c=s&&i?i.annotations.find(e=>e.id===s):null,d=o&&o.frames[n]?Object.values(o.frames[n].entities).filter(e=>"player"===e.type):[];if(c&&o)return(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold text-[var(--color-text-primary)] truncate",children:["Annotation: ",c.type.charAt(0).toUpperCase()+c.type.slice(1)," (",c.id.slice(0,4),")"]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-[var(--color-text-primary)]",children:"Type"}),(0,a.jsx)("div",{className:"px-3 py-2 text-sm bg-[var(--color-surface-warm)] border border-[var(--color-border)] font-mono capitalize",children:c.type})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-[var(--color-text-primary)]",children:"Start Frame"}),(0,a.jsxs)(L,{value:c.startFrameId,onValueChange:e=>l(c.id,{startFrameId:e}),children:[(0,a.jsx)(z,{className:"font-mono",children:(0,a.jsx)(_,{})}),(0,a.jsx)(O,{children:o.frames.map((e,t)=>(0,a.jsxs)(U,{value:e.id,children:["Frame ",t+1]},e.id))})]}),(0,a.jsx)("span",{className:"text-xs text-[var(--color-text-primary)] opacity-60",children:"Annotation visible from this frame onward"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-[var(--color-text-primary)]",children:"End Frame"}),(0,a.jsxs)(L,{value:c.endFrameId,onValueChange:e=>l(c.id,{endFrameId:e}),children:[(0,a.jsx)(z,{className:"font-mono",children:(0,a.jsx)(_,{})}),(0,a.jsx)(O,{children:o.frames.map((e,t)=>(0,a.jsxs)(U,{value:e.id,disabled:o.frames.findIndex(t=>t.id===e.id)<o.frames.findIndex(e=>e.id===c.startFrameId),children:["Frame ",t+1]},e.id))})]}),(0,a.jsx)("span",{className:"text-xs text-[var(--color-text-primary)] opacity-60",children:"Annotation visible from start to end frame"})]}),(0,a.jsx)(A,{label:"Color",value:c.color||"#FACC15",onChange:e=>l(c.id,{color:e})})]});if(!t)return(0,a.jsx)("div",{className:"p-4 text-sm text-[var(--color-text-primary)] opacity-60",children:"No entity selected"});let u="player"===t.type,m="ball"===t.type;return(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-semibold text-[var(--color-text-primary)] truncate",children:["Entity: ",t.label||(t.id?"Unnamed ".concat(t.type," (").concat(t.id.slice(0,4),")"):t.type)]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-[var(--color-text-primary)]",children:"Type"}),(0,a.jsx)("div",{className:"px-3 py-2 text-sm bg-[var(--color-surface-warm)] border border-[var(--color-border)] font-mono capitalize",children:t.type})]}),u&&(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-[var(--color-text-primary)]",children:"Label (Jersey #)"}),(0,a.jsx)(R,{type:"text",value:t.label||"",onChange:e=>r({label:e.target.value}),maxLength:10,placeholder:"e.g. 10",className:"font-mono"})]}),u&&(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-[var(--color-text-primary)]",children:"Team"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(E,{variant:"attack"===t.team?"default":"outline",size:"sm",onClick:()=>r({team:"attack"}),className:"flex-1",children:"Attack"}),(0,a.jsx)(E,{variant:"defense"===t.team?"default":"outline",size:"sm",onClick:()=>r({team:"defense"}),className:"flex-1",children:"Defense"}),(0,a.jsx)(E,{variant:"neutral"===t.team?"default":"outline",size:"sm",onClick:()=>r({team:"neutral"}),className:"flex-1",children:"Neutral"})]})]}),m&&(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-[var(--color-text-primary)]",children:"Possession"}),(0,a.jsxs)(L,{value:t.parentId||"none",onValueChange:e=>r({parentId:"none"===e?void 0:e}),children:[(0,a.jsx)(z,{className:"font-mono",children:(0,a.jsx)(_,{placeholder:"None"})}),(0,a.jsxs)(O,{children:[(0,a.jsx)(U,{value:"none",children:"None"}),d.map(e=>(0,a.jsx)(U,{value:e.id,children:e.label||"Player ".concat(e.id.slice(0,4))},e.id))]})]})]}),(0,a.jsx)(A,{label:"Color",value:t.color||"#1A3D1A",onChange:e=>r({color:e})})]})}U.displayName=D.ck.displayName,o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(D.Z0,{ref:t,className:C("-mx-1 my-1 h-px bg-muted",r),...o})}).displayName=D.Z0.displayName;var Z=r(8964),G=r(1817),V=r(6475),B=r(3229),W=r(1341),J=r(9374);let X=(e,t)=>{try{let r=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}catch(e){throw console.error("Failed to download JSON file:",e),Error("Failed to download file")}},Y=e=>new Promise((t,r)=>{if(!e.name.endsWith(".json")){r(Error("Invalid file type. Please select a .json file."));return}let a=new FileReader;a.onload=e=>{try{var a;let r=null===(a=e.target)||void 0===a?void 0:a.result,o=JSON.parse(r);t(o)}catch(e){r(Error("Failed to parse JSON file. The file may be corrupted."))}},a.onerror=()=>{r(Error("Failed to read file."))},a.readAsText(e)}),K=e=>{let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),r=new Date().toISOString().split("T")[0];return"".concat(t||"rugby-play","-").concat(r,".json")};var $=r(3240),H=r(2489);let Q=$.fC;$.xz;let ee=$.h_;$.x8;let et=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)($.aV,{ref:t,className:C("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...o})});et.displayName=$.aV.displayName;let er=o.forwardRef((e,t)=>{let{className:r,children:o,...n}=e;return(0,a.jsxs)(ee,{children:[(0,a.jsx)(et,{}),(0,a.jsxs)($.VY,{ref:t,className:C("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...n,children:[o,(0,a.jsxs)($.x8,{className:"absolute right-4 top-4 rounded-none opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(H.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});er.displayName=$.VY.displayName;let ea=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:C("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})};ea.displayName="DialogHeader";let eo=e=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:C("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};eo.displayName="DialogFooter";let en=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)($.Dx,{ref:t,className:C("text-lg font-semibold leading-none tracking-tight",r),...o})});en.displayName=$.Dx.displayName;let el=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)($.dk,{ref:t,className:C("text-sm text-muted-foreground",r),...o})});el.displayName=$.dk.displayName;let es=e=>{let{open:t,onConfirm:r,onCancel:o,title:n,description:l,confirmLabel:s="Confirm",cancelLabel:i="Cancel",variant:c="default"}=e;return(0,a.jsx)(Q,{open:t,onOpenChange:e=>!e&&o(),children:(0,a.jsxs)(er,{className:"sm:max-w-[425px] bg-white dark:bg-slate-950",children:[(0,a.jsxs)(ea,{children:[(0,a.jsx)(en,{children:n}),(0,a.jsx)(el,{children:l})]}),(0,a.jsxs)(eo,{children:[(0,a.jsx)(E,{variant:"outline",onClick:o,children:i}),(0,a.jsx)(E,{variant:c,onClick:r,children:s})]})]})})},ei={"rugby-union":{width:2e3,height:1400,name:"Rugby Union"},"rugby-league":{width:2e3,height:1360,name:"Rugby League"},soccer:{width:2e3,height:1295,name:"Soccer"},"american-football":{width:2e3,height:1066,name:"American Football"}};function ec(e){let{currentSport:t,onSportChange:r}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{htmlFor:"sport-selector",className:"text-sm font-semibold text-pitch-green",children:"Field Type"}),(0,a.jsx)("select",{id:"sport-selector",value:t,onChange:e=>r(e.target.value),className:"w-full px-3 py-2 bg-white border border-pitch-green font-mono text-sm text-pitch-green focus:outline-none focus:ring-1 focus:ring-pitch-green",style:{borderRadius:0},children:["rugby-union","rugby-league","soccer","american-football"].map(e=>(0,a.jsx)("option",{value:e,children:ei[e].name},e))})]})}var ed=r(5395),eu=r(8919),em=r(4438);let ex="share_privacy_notice_shown";function ep(){let e=(0,x.i)(e=>e.project),{shareAnimation:t,isSharing:r,error:n}=function(){let[e,t]=(0,o.useState)(!1),[r,a]=(0,o.useState)(null);return{shareAnimation:async e=>{t(!0),a(null);try{let t=function(e){let t=0,r=e.frames.map(e=>{let r=t;return t+=e.duration/1e3,{t:r,updates:Object.values(e.entities).filter(e=>"player"===e.type||"ball"===e.type).map(e=>({id:e.id,x:e.x,y:e.y}))}});return{version:1,canvas:{width:2e3,height:2e3},entities:Object.values(e.frames.length>0?e.frames[0].entities:{}).filter(e=>"player"===e.type||"ball"===e.type).map(e=>({id:e.id,type:e.type,team:"defense"===e.team?"defence":e.team,x:e.x,y:e.y})),frames:r}}(e),r=await fetch("/api/share",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){if(404===r.status)throw Error("Share feature not available in development. Please deploy to Vercel or run the API server locally.");if(413===r.status)throw Error("Animation is too large to share. Try reducing the number of frames or removing complex elements.");if(500===r.status){if((await r.json().catch(()=>({}))).setupRequired)throw Error("Share feature not configured. Please set up Supabase environment variables.");throw Error("Server error occurred. Please try again later.")}let e=await r.json().catch(()=>({}));throw Error(e.error||"Failed to create share (".concat(r.status,")"))}let{id:a}=await r.json(),o=window.location.origin,n="".concat(o,"/replay/").concat(a);try{await navigator.clipboard.writeText(n)}catch(e){console.warn("Failed to copy to clipboard:",e)}return n}catch(e){return a(e instanceof Error?e.message:"Unknown error occurred while sharing"),console.error("Share animation error:",e),null}finally{t(!1)}},isSharing:e,error:r}}(),[l,s]=(0,o.useState)(navigator.onLine);(0,o.useEffect)(()=>{let e=()=>s(!0),t=()=>s(!1);return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]);let i=async()=>{e&&(localStorage.getItem(ex)||(em.Am.info("Privacy Notice: Shared animations are stored for 90 days and may be accessed by anyone with the link.",{duration:6e3}),localStorage.setItem(ex,"true")),await t(e)?em.Am.success("Link copied! Ready to paste into WhatsApp or other apps."):n&&(n.includes("development")?em.Am.error(n,{description:"Deploy to Vercel or run the API server locally to enable sharing.",duration:5e3}):n.includes("Supabase")?em.Am.error(n,{description:"Contact the administrator to complete the setup.",duration:5e3}):em.Am.error(n,{duration:4e3})))};return(0,a.jsx)(E,{onClick:i,disabled:!e||!l||r,variant:"secondary",className:"w-full gap-2",children:l?r?(0,a.jsx)(a.Fragment,{children:"Sharing..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eu.Z,{className:"h-4 w-4"}),"Share Link"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ed.Z,{className:"h-4 w-4"}),"Offline"]})})}let ef=e=>{let{currentSport:t,onSportChange:r,onExport:n,exportStatus:l="idle",exportProgress:s=0,exportError:i=null,canExport:c=!1,isAuthenticated:d=!1,onSaveToCloud:u}=e,m=(0,o.useRef)(null),p=(0,x.i)(e=>e.project),f=(0,x.i)(e=>e.isDirty),g=(0,x.i)(e=>e.saveProject),v=(0,x.i)(e=>e.loadProject),b=(0,x.i)(e=>e.newProject),y=(0,x.i)(e=>e.updateProjectSettings),w=h(e=>e.isLoading),j=h(e=>e.setLoadingState),N=h(e=>e.unsavedChangesDialog),C=h(e=>e.showUnsavedChangesDialog),k=h(e=>e.confirmPendingAction),S=h(e=>e.cancelPendingAction),R=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){j("load",!0);try{let e=await Y(r),t=v(e);t.success?t.warnings.length>0&&console.warn("Project loaded with warnings:",t.warnings):em.Am.error("Failed to load project:\n".concat(t.errors.join("\n")))}catch(t){let e=t instanceof Error?t.message:"Unknown error";em.Am.error("Failed to load project: ".concat(e))}finally{j("load",!1)}e.target.value=""}};return(0,a.jsxs)("div",{className:"flex flex-col gap-4 p-4 border-b border-[var(--color-border)]",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-[var(--color-text-primary)] mb-2",children:"Field Settings"}),(0,a.jsx)(ec,{currentSport:t,onSportChange:r})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-[var(--color-text-primary)] mb-2",children:"Project"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(E,{variant:"outline",size:"sm",onClick:()=>{f?C({type:"new-project"}):b()},className:"flex-1",children:[(0,a.jsx)(Z.Z,{className:"w-4 h-4 mr-2"}),"New"]}),(0,a.jsxs)(E,{variant:"outline",size:"sm",onClick:()=>{if(f)C({type:"load-project",data:null});else{var e;null===(e=m.current)||void 0===e||e.click()}},disabled:w.load,className:"flex-1",children:[w.load?(0,a.jsx)(G.Z,{className:"w-4 h-4 mr-2 animate-spin"}):(0,a.jsx)(V.Z,{className:"w-4 h-4 mr-2"}),"Open"]})]}),(0,a.jsxs)(E,{variant:"default",size:"sm",onClick:()=>{if(p){j("save",!0);try{let e=g(),t=K(p.name);X(t,e)}catch(t){let e=t instanceof Error?t.message:"Unknown error";alert("Failed to save project: ".concat(e))}finally{setTimeout(()=>j("save",!1),300)}}},disabled:!p||w.save,className:"w-full bg-[var(--color-accent-warm)] hover:bg-[#B45309] text-white",children:[w.save?(0,a.jsx)(G.Z,{className:"w-4 h-4 mr-2 animate-spin"}):(0,a.jsx)(B.Z,{className:"w-4 h-4 mr-2"}),"Save Local"]}),d&&u&&(0,a.jsxs)(E,{variant:"default",size:"sm",onClick:u,disabled:!p,className:"w-full bg-[var(--color-primary)] hover:bg-[var(--color-primary)]/90 text-white mt-2",children:[(0,a.jsx)(W.Z,{className:"w-4 h-4 mr-2"}),"Save to Cloud"]}),!d&&(0,a.jsxs)("a",{href:"/login?redirect=/app",className:"w-full mt-2 inline-flex items-center justify-center px-3 py-2 text-sm font-medium border border-[var(--color-border)] text-[var(--color-text-primary)] hover:bg-[var(--color-surface-warm)] transition-colors",children:[(0,a.jsx)(W.Z,{className:"w-4 h-4 mr-2"}),"Sign in to Save"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-[var(--color-text-primary)] mb-2",children:"Share"}),(0,a.jsx)(ep,{})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-[var(--color-text-primary)] mb-2",children:"Export Settings"}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 mb-3",children:[(0,a.jsx)("label",{className:"text-xs font-bold text-[var(--color-text-primary)]",children:"Export Resolution"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(E,{variant:(null==p?void 0:p.settings.exportResolution)==="720p"?"default":"outline",size:"sm",onClick:()=>y({exportResolution:"720p"}),disabled:!p,className:"flex-1 ".concat((null==p?void 0:p.settings.exportResolution)==="720p"?"bg-[var(--color-accent-warm)] hover:bg-[#B45309] text-white":""),children:[(null==p?void 0:p.settings.exportResolution)==="720p"&&"✓ ","720p"]}),(0,a.jsxs)(E,{variant:(null==p?void 0:p.settings.exportResolution)==="1080p"?"default":"outline",size:"sm",onClick:()=>y({exportResolution:"1080p"}),disabled:!p,className:"flex-1 ".concat((null==p?void 0:p.settings.exportResolution)==="1080p"?"bg-[var(--color-accent-warm)] hover:bg-[#B45309] text-white":""),children:[(null==p?void 0:p.settings.exportResolution)==="1080p"&&"✓ ","1080p"]})]})]}),(0,a.jsxs)(E,{variant:"outline",size:"sm",onClick:n,disabled:!c||"idle"!==l,className:"w-full",children:[(0,a.jsx)(J.Z,{className:"w-4 h-4 mr-2"}),"Export Video"]}),"idle"!==l&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-[var(--color-surface-warm)] border border-[var(--color-accent-warm)]",children:[(0,a.jsxs)("div",{className:"text-xs font-mono text-[var(--color-text-primary)] mb-1",children:["preparing"===l&&"Preparing...","capturing"===l&&"Capturing frames...","encoding"===l&&"Encoding video...","complete"===l&&"✓ Complete!","error"===l&&"✗ Error"]}),"error"!==l&&(0,a.jsx)("div",{className:"w-full h-2 bg-[var(--color-surface)]",children:(0,a.jsx)("div",{className:"h-full bg-[var(--color-accent-warm)] transition-all duration-300",style:{width:"".concat(s,"%")}})}),"error"===l&&i&&(0,a.jsx)("div",{className:"text-xs text-red-600 mt-1",children:i})]}),(0,a.jsx)("input",{ref:m,type:"file",accept:".json",onChange:R,className:"hidden","aria-label":"Select project file to open"}),(0,a.jsx)(es,{open:N.isOpen,onConfirm:()=>{let e=N.pendingAction;if(k(),e){if("new-project"===e.type)b();else if("load-project"===e.type){var t;null===(t=m.current)||void 0===t||t.click()}}},onCancel:S,title:"Unsaved Changes",description:"You have unsaved changes. If you continue, you will lose your work. Are you sure?",confirmLabel:"Discard Changes",cancelLabel:"Keep Editing",variant:"destructive"})]})]})};var eh=r(8867),eg=r(8846);let ev=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsxs)(eg.fC,{ref:t,className:C("relative flex w-full touch-none select-none items-center",r),...o,children:[(0,a.jsx)(eg.fQ,{className:"relative h-1.5 w-full grow overflow-hidden rounded-none bg-primary/20",children:(0,a.jsx)(eg.e6,{className:"absolute h-full bg-primary"})}),(0,a.jsx)(eg.bU,{className:"block h-4 w-4 rounded-none border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})});ev.displayName=eg.fC.displayName;var eb=r(525);let ey=e=>{let{frame:t,displayIndex:r,isActive:n,onClick:l,onDelete:s,onDuplicate:c,onDurationChange:d}=e,[u,m]=o.useState(!1),[x,p]=o.useState(t.duration/1e3);return o.useEffect(()=>{p(t.duration/1e3)},[t.duration]),(0,a.jsxs)("div",{className:"relative flex flex-col items-center gap-1 cursor-pointer",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[(0,a.jsx)("div",{className:"\n          w-16 h-12\n          border\n          ".concat(n?"border-2":"border","\n          ").concat(n?"border-pitch-green":"border-[var(--color-border)]","\n          bg-[var(--color-surface-warm)]\n          flex items-center justify-center\n          font-mono text-sm\n          hover:bg-[var(--color-surface)]\n          transition-colors\n          relative\n        "),style:{borderColor:n?i.q.colors.primary:void 0,borderRadius:0},onClick:l,children:(0,a.jsx)("span",{className:"font-mono text-xs text-[var(--color-text-primary)] select-none",children:r})}),(0,a.jsxs)("div",{className:"flex flex-col items-center w-full gap-1 px-1",children:[(0,a.jsxs)("span",{className:"font-mono text-[10px] text-[var(--color-text-primary)] tabular-nums opacity-75",children:[x.toFixed(1),"s"]}),(0,a.jsx)("div",{className:"w-full px-1",onClick:e=>e.stopPropagation(),children:(0,a.jsx)(ev,{value:[x],min:eb.a.FRAME.DURATION_MIN_MS/1e3,max:eb.a.FRAME.DURATION_MAX_MS/1e3,step:.1,onValueChange:e=>{let r=e[0];p(r),d(t.id,1e3*r)},className:"[&_[role=slider]]:h-2 [&_[role=slider]]:w-2 [&_[role=slider]]:rounded-none [&_.relative]:h-1"})})]}),u&&(0,a.jsxs)("div",{className:"absolute top-0 right-0 flex gap-1 p-0.5",children:[(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),c()},className:"p-0.5 bg-[var(--color-surface)] hover:bg-[var(--color-surface-warm)] border border-[var(--color-border)]",style:{borderRadius:0},title:"Duplicate frame",children:(0,a.jsx)(eh.Z,{size:10})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),s()},className:"p-0.5 bg-[var(--color-surface)] hover:bg-red-50 border border-[var(--color-border)]",style:{borderRadius:0},title:"Delete frame",children:(0,a.jsx)(H.Z,{size:10})})]})]})};var ew=r(9397);let ej=e=>{let{frames:t,currentFrameIndex:r,onFrameSelect:o,onAddFrame:n,onRemoveFrame:l,onDuplicateFrame:s,onDurationChange:i,maxFrames:c=50,isAuthenticated:d=!1,onShowGuestLimitModal:u}=e,m=t.length>=c;return(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-[var(--color-surface-warm)] border-t border-[var(--color-accent-warm)] overflow-x-auto",children:[t.map((e,t)=>(0,a.jsx)(ey,{frame:e,displayIndex:t+1,isActive:t===r,onClick:()=>o(t),onDelete:()=>l(e.id),onDuplicate:()=>s(e.id),onDurationChange:i},e.id)),(0,a.jsx)("button",{onClick:n,className:"\n          flex items-center justify-center\n          w-16 h-12\n          border border-[var(--color-accent-warm)]\n          transition-colors\n          font-mono text-xs\n          ".concat(m?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-[var(--color-surface)] hover:bg-[var(--color-accent-warm)] hover:text-white","\n        "),title:m?d?"Maximum frames reached":"Register for more frames":"Add frame","aria-label":m?"Frame limit reached":"Add new frame",children:(0,a.jsx)(ew.Z,{size:16})}),m&&!d&&(0,a.jsx)("button",{onClick:u,className:"ml-2 px-3 py-1 text-xs bg-[var(--color-primary)] text-white hover:bg-[var(--color-primary)]/90 transition-colors",children:"Unlock more frames"})]})};var eN=r(9227),eC=r(3276),ek=r(9076),eE=r(2451),eS=r(407),eR=r(1637),eA=r(8110),eD=r(1473);let eF=e=>{let{isPlaying:t,speed:r,loopEnabled:o,currentFrame:n,totalFrames:l,onPlay:s,onPause:i,onReset:c,onPreviousFrame:d,onNextFrame:u,onSpeedChange:m,onLoopToggle:x,ghostEnabled:p,onGhostToggle:f,gridEnabled:h,onGridToggle:g}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-4 p-2 bg-[var(--color-surface-warm)] border-b border-[var(--color-accent-warm)]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:t?i:s,className:"p-2 hover:bg-[var(--color-accent-warm)] hover:text-white border border-[var(--color-accent-warm)] rounded",title:t?"Pause":"Play","aria-label":t?"Pause animation":"Play animation",children:t?(0,a.jsx)(eN.Z,{size:16}):(0,a.jsx)(eC.Z,{size:16})}),(0,a.jsx)("button",{onClick:c,className:"p-2 hover:bg-[var(--color-accent-warm)] hover:text-white border border-[var(--color-accent-warm)] rounded",title:"Reset to frame 1","aria-label":"Reset to frame 1",children:(0,a.jsx)(ek.Z,{size:16})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{onClick:d,className:"p-2 hover:bg-[var(--color-accent-warm)] hover:text-white border border-[var(--color-accent-warm)] rounded",title:"Previous frame","aria-label":"Previous frame",disabled:0===n,children:(0,a.jsx)(eE.Z,{size:16})}),(0,a.jsxs)("span",{className:"font-mono text-sm px-2 text-[var(--color-text-primary)]",children:[n+1,"/",l]}),(0,a.jsx)("button",{onClick:u,className:"p-2 hover:bg-[var(--color-accent-warm)] hover:text-white border border-[var(--color-accent-warm)] rounded",title:"Next frame","aria-label":"Next frame",disabled:n>=l-1,children:(0,a.jsx)(eS.Z,{size:16})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"font-mono text-xs text-[var(--color-text-primary)]",children:"Speed:"}),[.5,1,2].map(e=>(0,a.jsxs)("button",{onClick:()=>m(e),className:"\n              px-2 py-1\n              font-mono text-xs\n              border border-[var(--color-accent-warm)]\n              ".concat(r===e?"bg-[var(--color-accent-warm)] text-white":"bg-[var(--color-surface)] hover:bg-[var(--color-accent-warm)] hover:text-white","\n            "),title:"".concat(e,"x speed"),children:[e,"x"]},e))]}),(0,a.jsx)("button",{onClick:x,className:"\n          p-2\n          border border-[var(--color-accent-warm)]\n          rounded\n          ".concat(o?"bg-[var(--color-accent-warm)] text-white":"bg-[var(--color-surface)] hover:bg-[var(--color-accent-warm)] hover:text-white","\n        "),title:o?"Loop enabled":"Loop disabled","aria-label":o?"Disable loop":"Enable loop",children:(0,a.jsx)(eR.Z,{size:16})}),(0,a.jsx)("button",{onClick:f,className:"\n          p-2\n          border border-[var(--color-accent-warm)]\n          rounded-none\n          ".concat(p?"bg-[var(--color-accent-warm)] text-white":"bg-[var(--color-surface)] hover:bg-[var(--color-accent-warm)] hover:text-white","\n        "),title:p?"Ghost mode enabled":"Ghost mode disabled","aria-label":p?"Disable ghost mode":"Enable ghost mode",children:(0,a.jsx)(eA.Z,{size:16})}),(0,a.jsx)("button",{onClick:g,className:"\n          p-2\n          border border-[var(--color-accent-warm)]\n          rounded-none\n          ".concat(h?"bg-[var(--color-accent-warm)] text-white":"bg-[var(--color-surface)] hover:bg-[var(--color-accent-warm)] hover:text-white","\n        "),title:h?"Grid overlay enabled":"Grid overlay disabled","aria-label":h?"Disable grid overlay":"Enable grid overlay",children:(0,a.jsx)(eD.Z,{size:16})})]})},eP=()=>{let e=(0,x.i)(e=>e.project),t=(0,x.i)(e=>e.isDirty),r=(0,x.i)(e=>e.saveProject);(0,o.useEffect)(()=>{if(!e)return;let t=setInterval(()=>{let e=r();try{localStorage.setItem("rugby_animator_autosave",e),localStorage.setItem("rugby_animator_autosave_timestamp",new Date().toISOString()),console.log("Auto-saved project to localStorage")}catch(t){if(console.error("Failed to auto-save project:",t),t instanceof DOMException&&"QuotaExceededError"===t.name)try{localStorage.removeItem("rugby_animator_autosave"),localStorage.removeItem("rugby_animator_autosave_timestamp"),localStorage.setItem("rugby_animator_autosave",e),localStorage.setItem("rugby_animator_autosave_timestamp",new Date().toISOString()),console.log("Cleared old autosave and saved successfully")}catch(e){console.error("Failed to save even after clearing:",e)}}},eb.a.STORAGE.AUTOSAVE_INTERVAL_MS);return()=>clearInterval(t)},[e,r]),(0,o.useEffect)(()=>{let e=e=>{if(t)return e.preventDefault(),e.returnValue="",""};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[t])};function eI(e){let{position:t,onDuplicate:r,onDelete:n,onEditLabel:l,onClose:s}=e,i=(0,o.useRef)(null);return((0,o.useEffect)(()=>{if(!t)return;let e=e=>{i.current&&!i.current.contains(e.target)&&s()},r=e=>{"Escape"===e.key&&s()};return document.addEventListener("mousedown",e),document.addEventListener("keydown",r),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",r)}},[t,s]),t)?(0,a.jsxs)("div",{ref:i,className:"fixed z-50 w-48 bg-white border border-[var(--color-border)] shadow-lg",style:{left:"".concat(t.x,"px"),top:"".concat(t.y,"px")},children:[(0,a.jsx)("button",{onClick:()=>{l(),s()},className:"w-full px-4 py-2 text-left text-sm hover:bg-pitch-green hover:text-tactics-white transition-colors border-b border-[var(--color-surface-warm)]",children:"Edit Label"}),(0,a.jsx)("button",{onClick:()=>{r(),s()},className:"w-full px-4 py-2 text-left text-sm hover:bg-pitch-green hover:text-tactics-white transition-colors border-b border-[var(--color-surface-warm)]",children:"Duplicate"}),(0,a.jsx)("button",{onClick:()=>{n(),s()},className:"w-full px-4 py-2 text-left text-sm hover:bg-red-600 hover:text-white transition-colors",children:"Delete"})]}):null}var eL=r(2249);class e_ extends o.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e),console.error("Error details:",t)}render(){if(this.state.hasError){let{fallbackTitle:e="Application Error"}=this.props,{error:t}=this.state;return(0,a.jsx)("div",{className:"flex items-center justify-center h-full bg-pitch-green p-8",children:(0,a.jsxs)("div",{className:"bg-tactics-white border-4 border-pitch-green p-8 max-w-2xl",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-heading font-bold text-pitch-green mb-2",children:e}),(0,a.jsx)("p",{className:"text-[var(--color-text-primary)] mb-4",children:"Something went wrong in this section of the application."}),t&&(0,a.jsxs)("details",{className:"mb-4",children:[(0,a.jsx)("summary",{className:"cursor-pointer text-sm font-mono text-[var(--color-text-primary)] opacity-75 hover:text-pitch-green",children:"Technical Details"}),(0,a.jsxs)("pre",{className:"mt-2 p-4 bg-[var(--color-surface-warm)] text-xs font-mono overflow-auto",children:[t.message,t.stack&&"\n\n".concat(t.stack)]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("p",{className:"text-sm text-[var(--color-text-primary)] opacity-75 mb-4",children:"You can try refreshing the page or starting a new project to recover."}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(E,{onClick:this.handleRefresh,variant:"default",className:"flex-1",children:"Refresh Page"}),(0,a.jsx)(E,{onClick:this.handleStartNew,variant:"outline",className:"flex-1",children:"Start New Project"})]})]})]})})}return this.props.children}constructor(e){super(e),(0,eL._)(this,"handleRefresh",()=>{window.location.reload()}),(0,eL._)(this,"handleStartNew",()=>{localStorage.clear(),window.location.reload()}),this.state={hasError:!1,error:null}}}function ez(e){var t,r,n;let{isAuthenticated:d=!1,onSaveToCloud:p}=e,f=(0,o.useRef)(null),{project:y,currentFrameIndex:w,isPlaying:j,playbackSpeed:N,loopPlayback:C,playbackPosition:k,isDirty:E,newProject:R,loadProject:A,addFrame:D,setCurrentFrame:F,removeFrame:P,duplicateFrame:I,addEntity:L,updateEntity:_,play:z,pause:M,reset:T,setPlaybackSpeed:O,toggleLoop:U,updateFrame:Z,updateProjectSettings:G,addAnnotation:V}=(0,x.i)(),{selectedEntityId:B,selectEntity:W,deselectAll:J,showGhosts:X,toggleGhosts:Y,showGrid:K,toggleGrid:$,selectedAnnotationId:H,selectAnnotation:Q,drawingMode:ee,setDrawingMode:et}=h(),{exportStatus:er,exportProgress:ea,exportError:eo,startExport:en,canExport:el}=function(e){let[t,r]=(0,o.useState)({status:"idle",progress:0,error:null,phase:""}),a=(0,x.i)(e=>e.project),n=function(e){let[t,r]=(0,o.useState)({isCapturing:!1,progress:0,error:null,frameCount:0}),a=(0,o.useRef)(!1),n=(0,o.useRef)([]),l=(0,x.i)(e=>e.project),s=(0,o.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"720p";if(!e.current||!l)return r(e=>({...e,error:"Canvas or project not ready"})),null;let o=e.current,s=l.frames;if(s.length<2)return r(e=>({...e,error:"At least 2 frames required for export"})),null;let i=function(e){let t=eb.a.EXPORT.RESOLUTIONS[e];return{width:t.width,height:t.height,fps:30,crf:22,gopSize:30}}(t),c=s.reduce((e,t)=>e+t.duration,0)/1e3,d=Math.ceil(c*i.fps);a.current=!1,n.current=[],r({isCapturing:!0,progress:0,error:null,frameCount:0});let u=o.width(),m=o.height(),p=o.scale();try{o.width(i.width),o.height(i.height),o.scale({x:i.width/2e3,y:i.height/2e3});let e=[];for(let t=0;t<d;t++){if(a.current)throw Error("Export cancelled");let n=t/i.fps*1e3,l=0,c=0,u=0;for(let e=0;e<s.length-1;e++){let t=l+s[e].duration;if(n<t){c=e,u=(n-l)/s[e].duration;break}l=t,c=e+1}let m=x.i.getState();m.setCurrentFrame(c),m.setPlaybackPosition({fromFrameIndex:c,toFrameIndex:Math.min(c+1,s.length-1),progress:Math.min(u,1)}),await new Promise(e=>setTimeout(e,0)),o.batchDraw();let p=o.toDataURL({pixelRatio:1,mimeType:"image/png"}),f=await fetch(p),h=await f.blob();e.push(h);let g=Math.round((t+1)/d*100);r(t=>({...t,progress:g,frameCount:e.length}))}n.current=e,o.width(u),o.height(m),o.scale(p||{x:1,y:1}),o.batchDraw();let t=x.i.getState();return t.setCurrentFrame(0),t.setPlaybackPosition({fromFrameIndex:0,toFrameIndex:0,progress:0}),r(e=>({...e,isCapturing:!1,progress:100})),{frames:e,fps:i.fps,width:i.width,height:i.height,totalDuration:c}}catch(t){o.width(u),o.height(m),o.scale(p||{x:1,y:1}),o.batchDraw();let e=t instanceof Error?t.message:"Frame capture failed";return r(t=>({...t,isCapturing:!1,error:e})),null}},[e,l]),i=(0,o.useCallback)(()=>{a.current=!0},[]);return{...t,captureFrames:s,cancel:i}}(e),l=(0,o.useCallback)(()=>a?a.frames.length<2?{valid:!1,error:"Minimum 2 frames required for export"}:a.frames.reduce((e,t)=>e+t.duration,0)>3e5?{valid:!1,error:"Animation exceeds maximum duration of 5 minutes"}:{valid:!0}:{valid:!1,error:"No project loaded"},[a]),s=(0,o.useCallback)(async()=>{var t;let o=l();if(!o.valid){r({status:"error",progress:0,error:o.error||"Export validation failed",phase:""});return}if(!e.current){r({status:"error",progress:0,error:"Canvas not ready for export",phase:""});return}let s=(null==a?void 0:null===(t=a.settings)||void 0===t?void 0:t.exportResolution)||"720p",i=await n.captureFrames(s);if(!i){r({status:"error",progress:0,error:"Frame capture failed",phase:""});return}try{let e=document.createElement("canvas");e.width=i.width,e.height=i.height;let t=e.getContext("2d");if(!t)throw Error("Could not get canvas context");let a=e.captureStream(i.fps),o=new MediaRecorder(a,{mimeType:"video/webm",videoBitsPerSecond:25e5}),n=[];o.ondataavailable=e=>{e.data.size>0&&n.push(e.data)},o.start();for(let r=0;r<i.frames.length;r++){let a=i.frames[r],o=new Image;await new Promise(r=>{o.onload=()=>{t.clearRect(0,0,e.width,e.height),t.drawImage(o,0,0,e.width,e.height),r()},o.src=URL.createObjectURL(a)}),await new Promise(e=>setTimeout(e,1e3/i.fps))}await new Promise(e=>{o.onstop=()=>e(),o.stop()});let l=new Blob(n,{type:"video/webm"}),s=URL.createObjectURL(l),c=document.createElement("a");c.href=s,c.download="animation-".concat(Date.now(),".webm"),document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(s),r({status:"complete",progress:100,error:null,phase:"Export complete",fileSize:l.size})}catch(e){r({status:"error",progress:0,error:e instanceof Error?e.message:"Export failed",phase:""})}},[l,e,n]),i=(0,o.useCallback)(()=>{r({status:"idle",progress:0,error:null,phase:"Cancelled"})},[]);return{exportStatus:t.status,exportProgress:t.progress,exportError:t.error,exportPhase:t.phase,fileSize:t.fileSize,startExport:s,cancelExport:i,canExport:null!==a&&a.frames.length>=2,isExporting:"idle"!==t.status&&"complete"!==t.status&&"error"!==t.status,get exportSettings(){var c;let e=(null==a?void 0:null===(c=a.settings)||void 0===c?void 0:c.exportResolution)||"720p",t=eb.a.EXPORT.RESOLUTIONS[e];return{width:t.width,height:t.height,fps:30}}}}(f),[ei,ec]=(0,o.useState)(!1),[ed,eu]=(0,o.useState)(null),[ex,ep]=(0,o.useState)(null),[eh,eg]=(0,o.useState)(null),[ev,ey]=(0,o.useState)(null);!function(){let e=(0,o.useRef)(null),t=(0,o.useRef)(null),r=(0,o.useRef)(0),{project:a,currentFrameIndex:n,isPlaying:l,playbackSpeed:s,loopPlayback:i,setCurrentFrame:c,pause:d,setPlaybackPosition:u}=(0,x.i)();(0,o.useEffect)(()=>{if(!l||!a){t.current=null,r.current=0;return}if(0===a.frames.length)return;let o=l=>{null===t.current&&(t.current=l);let m=l-t.current;t.current=l,r.current+=m*s;let x=a.frames[n];if(!x){d();return}let p=r.current/x.duration;if(p>=1){if(r.current=0,n>=a.frames.length-1){if(i)c(0);else{d();return}}else c(n+1)}else{let e=n+1>=a.frames.length?i?0:n:n+1;u({fromFrameIndex:n,toFrameIndex:e,progress:p})}e.current=requestAnimationFrame(o)};return e.current=requestAnimationFrame(o),()=>{null!==e.current&&(cancelAnimationFrame(e.current),e.current=null)}},[l,a,n,s,i,c,d,u])}(),function(){let{isPlaying:e,play:t,pause:r,currentFrameIndex:a,setCurrentFrame:n,removeEntity:l,removeAnnotation:s,saveProject:i,project:c}=(0,x.i)(),{selectedEntityId:d,selectedAnnotationId:u,deselectAll:m,selectAnnotation:p,drawingMode:f,setDrawingMode:g}=h();(0,o.useEffect)(()=>{let o=o=>{let x=o.target;if("INPUT"!==x.tagName&&"TEXTAREA"!==x.tagName&&!x.isContentEditable){if("Space"===o.code){o.preventDefault(),e?r():t();return}if("Delete"===o.code||"Backspace"===o.code){o.preventDefault(),d?(l(d),m()):u&&(s(u),p(null));return}if((o.ctrlKey||o.metaKey)&&"KeyS"===o.code){o.preventDefault(),c&&i();return}if("ArrowLeft"===o.code){o.preventDefault(),a>0&&n(a-1);return}if("ArrowRight"===o.code){o.preventDefault(),c&&a<c.frames.length-1&&n(a+1);return}if("Escape"===o.code){o.preventDefault(),"none"!==f&&g("none"),m(),p(null);return}}};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e,t,r,a,n,l,s,i,c,d,u,m,p,f,g])}(),eP(),(0,o.useEffect)(()=>{let e=e=>{E&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[E]),(0,o.useEffect)(()=>{if(!y){let e=localStorage.getItem("rugby_animator_autosave"),t=localStorage.getItem("rugby_animator_autosave_timestamp");if(e&&t)try{let r=JSON.parse(e),a=new Date(t);if((new Date().getTime()-a.getTime())/6e4<1440){eu(r),ec(!0);return}}catch(e){console.error("Failed to parse autosave data:",e)}R()}},[y,R]);let[ew,eN]=(0,o.useState)(!1),eC=d?eb.a.PROJECT.MAX_FRAMES:eb.a.PROJECT.GUEST_MAX_FRAMES,ek=null==y?void 0:y.frames[w],eE=ek?Object.values(ek.entities):[],eS=ek?ek.annotations:[],eR=e=>{let t=eE.find(t=>t.id===e);if(!t||!f.current)return;let r=f.current.container().getBoundingClientRect();ep({entityId:e,position:{x:r.left+t.x-40,y:r.top+t.y-15},initialValue:t.label||""})};return(0,a.jsxs)("div",{className:"flex h-screen bg-[var(--color-surface-warm)]",children:[(0,a.jsxs)("aside",{className:"w-64 border-r border-[var(--color-border)] bg-pitch-green flex flex-col",children:[(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)("h1",{className:"text-xl font-heading font-bold text-tactics-white mb-6",children:"Rugby Animation Tool"})}),(0,a.jsx)(e_,{fallbackTitle:"Sidebar Error",children:(0,a.jsxs)("div",{className:"bg-tactics-white flex-1 overflow-y-auto",children:[(0,a.jsx)(ef,{currentSport:(null==y?void 0:y.sport)||"rugby-union",onSportChange:e=>{G({sport:e})},onExport:en,exportStatus:er,exportProgress:ea,exportError:eo,canExport:el,isAuthenticated:d,onSaveToCloud:p}),(0,a.jsx)(S,{onAddAttackPlayer:()=>{L({type:"player",x:400,y:300,team:"attack",color:i.q.colors.attack[0],label:""})},onAddDefensePlayer:()=>{L({type:"player",x:400,y:300,team:"defense",color:i.q.colors.defense[0],label:""})},onAddBall:()=>{L({type:"ball",x:400,y:300,team:"neutral",color:i.q.colors.neutral[0],label:""})},onAddCone:()=>{L({type:"cone",x:400,y:300,team:"neutral",color:i.q.colors.neutral[1],label:""})},onAddMarker:()=>{L({type:"marker",x:400,y:300,team:"neutral",color:i.q.colors.neutral[2],label:""})},drawingMode:ee,onDrawingModeChange:et}),(0,a.jsx)(q,{entity:B&&eE.find(e=>e.id===B)||null,onUpdate:e=>{B&&_(B,e)}})]})})]}),(0,a.jsxs)("main",{className:"flex-1 flex flex-col",children:[(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-4 bg-[var(--color-surface-warm)]",children:(0,a.jsx)(e_,{fallbackTitle:"Canvas Error",children:(0,a.jsx)("div",{className:"border border-[var(--color-accent-warm)] bg-white",children:(0,a.jsxs)(l,{ref:f,width:800,height:600,onCanvasClick:()=>{J()},children:[(0,a.jsx)(s,{sport:(null==y?void 0:y.sport)||"rugby-union",width:800,height:600}),(0,a.jsx)(c,{width:800,height:600,visible:K}),(0,a.jsx)(g,{}),(0,a.jsx)(u,{entities:eE,selectedEntityId:B,onEntitySelect:e=>{W(e)},onEntityMove:(e,t,r)=>{_(e,{x:t,y:r})},onEntityDoubleClick:eR,onEntityContextMenu:(e,t)=>{if(!f.current)return;let r=f.current.container().getBoundingClientRect();eg({entityId:e,position:{x:r.left+t.x,y:r.top+t.y}})},interactive:!j,playbackPosition:k,frames:null!==(t=null==y?void 0:y.frames)&&void 0!==t?t:[]}),(0,a.jsx)(v,{annotations:eS,selectedAnnotationId:H,onAnnotationSelect:Q,onContextMenu:(e,t)=>{if(!f.current)return;let r=f.current.container().getBoundingClientRect();ey({annotationId:e,position:{x:r.left+t.x,y:r.top+t.y}})},interactive:!j,currentFrameId:(null==ek?void 0:ek.id)||"",frameIds:(null==y?void 0:y.frames.map(e=>e.id))||[]}),(0,a.jsx)(b,{drawingMode:ee,defaultColor:i.q.colors.annotation,onDrawingComplete:(e,t)=>{V({type:t,points:e,color:i.q.colors.annotation}),et("none")},interactive:!j,width:800,height:600})]})})})}),(0,a.jsx)(e_,{fallbackTitle:"Timeline Error",children:(0,a.jsxs)("footer",{className:"border-t border-[var(--color-accent-warm)]",children:[(0,a.jsx)(eF,{isPlaying:j,speed:N,loopEnabled:C,currentFrame:w,totalFrames:null!==(r=null==y?void 0:y.frames.length)&&void 0!==r?r:0,onPlay:z,onPause:M,onReset:T,onPreviousFrame:()=>{w>0&&F(w-1)},onNextFrame:()=>{y&&w<y.frames.length-1&&F(w+1)},onSpeedChange:O,onLoopToggle:U,ghostEnabled:X,onGhostToggle:Y,gridEnabled:K,onGridToggle:$}),(0,a.jsx)(ej,{frames:null!==(n=null==y?void 0:y.frames)&&void 0!==n?n:[],currentFrameIndex:w,onFrameSelect:F,onAddFrame:()=>{if(y){if(y.frames.length>=eC){d||eN(!0);return}D()}},onRemoveFrame:P,onDuplicateFrame:I,onDurationChange:(e,t)=>{Z(e,{duration:t})},maxFrames:eC,isAuthenticated:d,onShowGuestLimitModal:()=>eN(!0)})]})})]}),(0,a.jsx)(es,{open:ei,onConfirm:()=>{if(ed){let e=A(ed);e.success||(alert("Failed to recover project:\n".concat(e.errors.join("\n"))),R())}ec(!1),eu(null)},onCancel:()=>{ec(!1),eu(null),R()},title:"Recover Auto-Saved Project",description:"An auto-saved project was found. Would you like to recover it?",confirmLabel:"Recover",cancelLabel:"Start Fresh",variant:"default"}),ex&&(0,a.jsx)(m,{initialValue:ex.initialValue,position:ex.position,onConfirm:e=>{ex&&_(ex.entityId,{label:e}),ep(null)},onCancel:()=>{ep(null)}}),(0,a.jsx)(eI,{position:(null==eh?void 0:eh.position)||null,onDuplicate:()=>{if(!eh||!y)return;let e=y.frames[w];if(!e)return;let t=e.entities[eh.entityId];t&&L({type:t.type,x:t.x+30,y:t.y+30,team:t.team,color:t.color,label:t.label})},onDelete:()=>{if(!eh)return;let{removeEntity:e}=x.i.getState();e(eh.entityId),J()},onEditLabel:()=>{eh&&eR(eh.entityId)},onClose:()=>eg(null)}),ev&&(0,a.jsx)("div",{className:"absolute z-50 border border-[var(--color-border)] bg-white shadow-lg",style:{left:ev.position.x,top:ev.position.y},onMouseLeave:()=>ey(null),children:(0,a.jsx)("button",{className:"block w-full px-4 py-2 text-left hover:bg-[var(--color-surface-warm)] text-sm",onClick:()=>{if(!ev)return;let{removeAnnotation:e}=x.i.getState();e(ev.annotationId),J(),ey(null)},children:"Delete"})}),(0,a.jsx)(em.x7,{position:"bottom-right"}),(0,a.jsx)(es,{open:ew,onConfirm:()=>{eN(!1),window.location.href="/register?redirect=/app"},onCancel:()=>eN(!1),title:"Frame Limit Reached",description:"Guest users can create up to ".concat(eb.a.PROJECT.GUEST_MAX_FRAMES," frames. Create a free account to unlock up to ").concat(eb.a.PROJECT.MAX_FRAMES," frames and save your animations to the cloud."),confirmLabel:"Create Free Account",cancelLabel:"Continue Editing",variant:"default"})]})}var eM=ez}}]);