"use strict";(()=>{var e={};e.id=941,e.ids=[941],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1048:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>w});var r={};a.r(r),a.d(r,{POST:()=>p});var n=a(9303),s=a(8716),o=a(670),i=a(7070),d=a(9692),u=a(9178),l=a(2521),c=a(5860);async function p(e){let t;let a=await (0,u.mk)();if((0,u.f1)(a))return a;let r=await (0,c.D)(a.id,"report");if(!r.allowed)return i.NextResponse.json({error:{code:"RATE_LIMITED",message:"Too many reports. Please try again later."}},{status:429,headers:(0,c.h)(r)});try{t=await e.json()}catch{return i.NextResponse.json({error:{code:"INVALID_JSON",message:"Invalid JSON body"}},{status:400})}let n=l.ZO.safeParse(t);if(!n.success)return i.NextResponse.json({error:{code:"VALIDATION_ERROR",message:n.error.message}},{status:400});let{animation_id:s,reason:o,details:p}=n.data,m=await (0,d.j)(),{data:_,error:w}=await m.from("saved_animations").select("id, visibility, user_id").eq("id",s).is("hidden_at",null).single();if(w||!_||"private"===_.visibility)return i.NextResponse.json({error:{code:"NOT_FOUND",message:"Animation not found"}},{status:404});if(_.user_id===a.id)return i.NextResponse.json({error:{code:"BAD_REQUEST",message:"Cannot report your own animation"}},{status:400});let{data:g}=await m.from("content_reports").select("id").eq("animation_id",s).eq("reporter_id",a.id).single();if(g)return i.NextResponse.json({error:{code:"ALREADY_REPORTED",message:"You have already reported this animation"}},{status:400});let{data:f,error:x}=await m.from("content_reports").insert({animation_id:s,reporter_id:a.id,reason:o,details:p||null,status:"pending"}).select("id, created_at").single();return x?(console.error("Database error:",x),i.NextResponse.json({error:{code:"DB_ERROR",message:"Failed to create report"}},{status:500})):i.NextResponse.json({id:f.id,created_at:f.created_at},{headers:(0,c.h)(r)})}let m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/report/route",pathname:"/api/report",filename:"route",bundlePath:"app/api/report/route"},resolvedPagePath:"C:\\Coding Projects\\coaching-animator\\app\\api\\report\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:w,serverHooks:g}=m,f="/api/report/route";function x(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:w})}},9178:(e,t,a)=>{a.d(t,{Mq:()=>l,PR:()=>s,f1:()=>d,kF:()=>i,mk:()=>o});var r=a(9692),n=a(7070);async function s(){let e=await (0,r.j)(),{data:{user:t}}=await e.auth.getUser();return t}async function o(){return await s()||n.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401})}async function i(){let e=await s();if(!e)return n.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let t=await (0,r.j)(),{data:a}=await t.from("user_profiles").select("role").eq("id",e.id).single();return a?.role!=="admin"?n.NextResponse.json({error:{code:"FORBIDDEN",message:"Admin access required"}},{status:403}):e}function d(e){return e instanceof n.NextResponse}async function u(e){let t=await (0,r.j)(),{data:a}=await t.from("user_profiles").select("banned_at, ban_reason").eq("id",e).single();return a?.banned_at?{banned:!0,reason:a.ban_reason||"Account suspended"}:{banned:!1}}async function l(e){let t=await u(e);return t.banned?n.NextResponse.json({error:{code:"ACCOUNT_BANNED",message:t.reason||"Your account has been suspended"}},{status:403}):null}},5860:(e,t,a)=>{a.d(t,{D:()=>s,h:()=>o});var r=a(9692);let n={create_animation:{maxRequests:10,windowMs:36e5},report:{maxRequests:5,windowMs:36e5},share:{maxRequests:10,windowMs:36e5},gallery:{maxRequests:100,windowMs:36e5}};async function s(e,t,a){let{maxRequests:s,windowMs:o}=a??n[t]??{maxRequests:100,windowMs:36e5},i=await (0,r.j)(),d=`${e}:${t}`,u=new Date(Date.now()-o),{data:l}=await i.from("rate_limits").select("count, window_start").eq("key",d).single();if(!l)return await i.from("rate_limits").insert({key:d,count:1,window_start:new Date().toISOString()}),{allowed:!0,remaining:s-1,resetAt:new Date(Date.now()+o)};let c=new Date(l.window_start);return c<u?(await i.from("rate_limits").update({count:1,window_start:new Date().toISOString()}).eq("key",d),{allowed:!0,remaining:s-1,resetAt:new Date(Date.now()+o)}):l.count>=s?{allowed:!1,remaining:0,resetAt:new Date(c.getTime()+o)}:(await i.from("rate_limits").update({count:l.count+1}).eq("key",d),{allowed:!0,remaining:s-l.count-1,resetAt:new Date(c.getTime()+o)})}function o(e){return{"X-RateLimit-Remaining":e.remaining.toString(),"X-RateLimit-Reset":e.resetAt.toISOString()}}},2521:(e,t,a)=>{a.d(t,{Cm:()=>i,Gd:()=>c,ZO:()=>u,Zz:()=>d,p7:()=>p});var r=a(6543);let n=r.KmV(["tactic","skill","game","other"]),s=r.KmV(["private","link_shared","public"]),o=r.KmV(["inappropriate","spam","copyright","other"]),i=r.Ryn({title:r.Z_8().min(1).max(100),description:r.Z_8().max(2e3).optional(),coaching_notes:r.Z_8().max(5e3).optional(),animation_type:n,tags:r.IXX(r.Z_8().max(30)).max(10).optional(),payload:r.Ryn({version:r.Z_8(),name:r.Z_8(),sport:r.Z_8(),frames:r.IXX(r.YjB()),settings:r.Ryn({}).passthrough()}),visibility:s.optional().default("private")}),d=i.partial(),u=r.Ryn({animation_id:r.Z_8().uuid(),reason:o,details:r.Z_8().max(500).optional()}),l=r.Ryn({limit:r.oQ2.number().min(1).max(50).default(20),offset:r.oQ2.number().min(0).default(0)}),c=l.extend({q:r.Z_8().optional(),type:n.optional(),tags:r.Z_8().optional(),sort:r.KmV(["created_at","upvote_count"]).default("created_at"),order:r.KmV(["asc","desc"]).default("desc")}),p=l.extend({sort:r.KmV(["title","created_at","duration_ms","animation_type"]).default("created_at"),order:r.KmV(["asc","desc"]).default("desc")})},9692:(e,t,a)=>{a.d(t,{j:()=>s});var r=a(2728),n=a(1615);async function s(){let e=await (0,n.cookies)();return(0,r.createServerClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:a,options:r})=>e.set(t,a,r))}catch{}}}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,637,972,543],()=>a(1048));module.exports=r})();