"use strict";(()=>{var e={};e.id=892,e.ids=[892],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},500:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>w,routeModule:()=>_,serverHooks:()=>R,staticGenerationAsyncStorage:()=>x});var n={};a.r(n),a.d(n,{GET:()=>g,POST:()=>f});var s=a(9303),r=a(8716),o=a(670),i=a(7070),d=a(9692),c=a(9178),u=a(2521),l=a(639),m=a(4954),p=a(5860);async function g(e){let t=await (0,c.mk)();if((0,c.f1)(t))return t;let a=Object.fromEntries(e.nextUrl.searchParams),n=u.p7.safeParse(a);if(!n.success)return i.NextResponse.json({error:{code:"INVALID_PARAMS",message:n.error.message}},{status:400});let s=await (0,d.j)(),{data:r,error:o,count:l}=await s.from("saved_animations").select("id, title, animation_type, duration_ms, frame_count, visibility, upvote_count, created_at, updated_at",{count:"exact"}).eq("user_id",t.id).order(n.data.sort,{ascending:"asc"===n.data.order}).range(n.data.offset,n.data.offset+n.data.limit-1);return o?(console.error("Database error:",o),i.NextResponse.json({error:{code:"DB_ERROR",message:"Failed to fetch animations"}},{status:500})):i.NextResponse.json({animations:r,total:l??0,limit:n.data.limit,offset:n.data.offset})}async function f(e){let t;let a=await (0,c.mk)();if((0,c.f1)(a))return a;let n=await (0,c.Mq)(a.id);if(n)return n;let s=await (0,p.D)(`user:${a.id}`,"create_animation");if(!s.allowed)return i.NextResponse.json({error:{code:"RATE_LIMITED",message:"Too many requests. Please try again later."}},{status:429,headers:(0,p.h)(s)});try{t=await e.json()}catch{return i.NextResponse.json({error:{code:"INVALID_JSON",message:"Invalid JSON body"}},{status:400})}let r=u.Cm.safeParse(t);if(!r.success)return i.NextResponse.json({error:{code:"VALIDATION_ERROR",message:r.error.message}},{status:400});let o=r.data,g=(0,m.e)({title:o.title,description:o.description,coaching_notes:o.coaching_notes});if(!g.passed)return i.NextResponse.json({error:{code:"CONTENT_VIOLATION",message:`Content contains inappropriate language: ${g.flaggedWords.join(", ")}`}},{status:400});let f=o.payload.frames?.length??0,_=o.payload.frames?.reduce((e,t)=>e+(t.duration??1e3),0)??0;if(f>50)return i.NextResponse.json({error:{code:"FRAME_LIMIT",message:"Animation cannot have more than 50 frames"}},{status:400});if(_>6e4)return i.NextResponse.json({error:{code:"DURATION_LIMIT",message:"Animation cannot be longer than 60 seconds"}},{status:400});let w=await (0,l.Wm)(a.id);if(!w.allowed)return i.NextResponse.json({error:{code:"QUOTA_EXCEEDED",message:`You have reached the maximum of ${w.max} animations. Delete some to create more.`}},{status:403});let x=await (0,d.j)(),{data:R,error:h}=await x.from("saved_animations").insert({user_id:a.id,title:o.title,description:o.description??null,coaching_notes:o.coaching_notes??null,animation_type:o.animation_type,tags:o.tags??[],payload:o.payload,duration_ms:_,frame_count:f,visibility:o.visibility}).select("id, created_at").single();return h?(console.error("Database error:",h),i.NextResponse.json({error:{code:"DB_ERROR",message:"Failed to save animation"}},{status:500})):i.NextResponse.json(R,{status:201})}let _=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/animations/route",pathname:"/api/animations",filename:"route",bundlePath:"app/api/animations/route"},resolvedPagePath:"C:\\Coding Projects\\coaching-animator\\app\\api\\animations\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:w,staticGenerationAsyncStorage:x,serverHooks:R}=_,h="/api/animations/route";function y(){return(0,o.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:x})}},9178:(e,t,a)=>{a.d(t,{Mq:()=>u,PR:()=>r,f1:()=>d,kF:()=>i,mk:()=>o});var n=a(9692),s=a(7070);async function r(){let e=await (0,n.j)(),{data:{user:t}}=await e.auth.getUser();return t}async function o(){return await r()||s.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401})}async function i(){let e=await r();if(!e)return s.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("role").eq("id",e.id).single();return a?.role!=="admin"?s.NextResponse.json({error:{code:"FORBIDDEN",message:"Admin access required"}},{status:403}):e}function d(e){return e instanceof s.NextResponse}async function c(e){let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("banned_at, ban_reason").eq("id",e).single();return a?.banned_at?{banned:!0,reason:a.ban_reason||"Account suspended"}:{banned:!1}}async function u(e){let t=await c(e);return t.banned?s.NextResponse.json({error:{code:"ACCOUNT_BANNED",message:t.reason||"Your account has been suspended"}},{status:403}):null}},4954:(e,t,a)=>{a.d(t,{e:()=>s});let n=RegExp("\\\b(fuck|shit|ass|bitch|damn|crap|piss|dick|cock|pussy|asshole|bastard|slut|whore|nigger|faggot|retard|cunt)\\\b","gi");function s(e){return function(e){if(!e)return{passed:!0,flaggedWords:[]};let t=e.match(n);return t&&t.length>0?{passed:!1,flaggedWords:[...new Set(t.map(e=>e.toLowerCase()))]}:{passed:!0,flaggedWords:[]}}([e.title??"",e.description??"",e.coaching_notes??""].join(" "))}},639:(e,t,a)=>{a.d(t,{Wm:()=>s});var n=a(9692);async function s(e){let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("animation_count").eq("id",e).single(),s=a?.animation_count??0;return{allowed:s<50,current:s,max:50}}},5860:(e,t,a)=>{a.d(t,{D:()=>r,h:()=>o});var n=a(9692);let s={create_animation:{maxRequests:10,windowMs:36e5},report:{maxRequests:5,windowMs:36e5},share:{maxRequests:10,windowMs:36e5},gallery:{maxRequests:100,windowMs:36e5}};async function r(e,t,a){let{maxRequests:r,windowMs:o}=a??s[t]??{maxRequests:100,windowMs:36e5},i=await (0,n.j)(),d=`${e}:${t}`,c=new Date(Date.now()-o),{data:u}=await i.from("rate_limits").select("count, window_start").eq("key",d).single();if(!u)return await i.from("rate_limits").insert({key:d,count:1,window_start:new Date().toISOString()}),{allowed:!0,remaining:r-1,resetAt:new Date(Date.now()+o)};let l=new Date(u.window_start);return l<c?(await i.from("rate_limits").update({count:1,window_start:new Date().toISOString()}).eq("key",d),{allowed:!0,remaining:r-1,resetAt:new Date(Date.now()+o)}):u.count>=r?{allowed:!1,remaining:0,resetAt:new Date(l.getTime()+o)}:(await i.from("rate_limits").update({count:u.count+1}).eq("key",d),{allowed:!0,remaining:r-u.count-1,resetAt:new Date(l.getTime()+o)})}function o(e){return{"X-RateLimit-Remaining":e.remaining.toString(),"X-RateLimit-Reset":e.resetAt.toISOString()}}},2521:(e,t,a)=>{a.d(t,{Cm:()=>i,Gd:()=>l,ZO:()=>c,Zz:()=>d,p7:()=>m});var n=a(6543);let s=n.KmV(["tactic","skill","game","other"]),r=n.KmV(["private","link_shared","public"]),o=n.KmV(["inappropriate","spam","copyright","other"]),i=n.Ryn({title:n.Z_8().min(1).max(100),description:n.Z_8().max(2e3).optional(),coaching_notes:n.Z_8().max(5e3).optional(),animation_type:s,tags:n.IXX(n.Z_8().max(30)).max(10).optional(),payload:n.Ryn({version:n.Z_8(),name:n.Z_8(),sport:n.Z_8(),frames:n.IXX(n.YjB()),settings:n.Ryn({}).passthrough()}),visibility:r.optional().default("private")}),d=i.partial(),c=n.Ryn({animation_id:n.Z_8().uuid(),reason:o,details:n.Z_8().max(500).optional()}),u=n.Ryn({limit:n.oQ2.number().min(1).max(50).default(20),offset:n.oQ2.number().min(0).default(0)}),l=u.extend({q:n.Z_8().optional(),type:s.optional(),tags:n.Z_8().optional(),sort:n.KmV(["created_at","upvote_count"]).default("created_at"),order:n.KmV(["asc","desc"]).default("desc")}),m=u.extend({sort:n.KmV(["title","created_at","duration_ms","animation_type"]).default("created_at"),order:n.KmV(["asc","desc"]).default("desc")})},9692:(e,t,a)=>{a.d(t,{j:()=>r});var n=a(2728),s=a(1615);async function r(){let e=await (0,s.cookies)();return(0,n.createServerClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:a,options:n})=>e.set(t,a,n))}catch{}}}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[948,637,972,543],()=>a(500));module.exports=n})();