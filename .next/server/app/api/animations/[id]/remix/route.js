"use strict";(()=>{var e={};e.id=19,e.ids=[19],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2047:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>_,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var n={};a.r(n),a.d(n,{POST:()=>l});var r=a(9303),i=a(8716),s=a(670),o=a(7070),c=a(9692),u=a(9178),d=a(639);async function l(e,{params:t}){let a=await (0,u.mk)();if((0,u.f1)(a))return a;let n=await (0,u.Mq)(a.id);if(n)return n;let{id:r}=await t,i=await (0,c.j)(),{data:s,error:l}=await i.from("saved_animations").select("*").eq("id",r).eq("visibility","public").is("hidden_at",null).single();if(l||!s)return o.NextResponse.json({error:{code:"NOT_FOUND",message:"Animation not found or not public"}},{status:404});let m=await (0,d.Wm)(a.id);if(!m.allowed)return o.NextResponse.json({error:{code:"QUOTA_EXCEEDED",message:`You have reached the maximum of ${m.max} animations. Delete some to create more.`}},{status:403});let p=`${s.title} (Remix)`.slice(0,100),{data:x,error:f}=await i.from("saved_animations").insert({user_id:a.id,title:p,description:s.description,coaching_notes:s.coaching_notes,animation_type:s.animation_type,tags:s.tags,payload:s.payload,duration_ms:s.duration_ms,frame_count:s.frame_count,visibility:"private"}).select("id, title, created_at").single();return f?(console.error("Remix insert error:",f),o.NextResponse.json({error:{code:"DB_ERROR",message:"Failed to create remix"}},{status:500})):o.NextResponse.json({id:x.id,title:x.title,created_at:x.created_at},{status:201})}let m=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/animations/[id]/remix/route",pathname:"/api/animations/[id]/remix",filename:"route",bundlePath:"app/api/animations/[id]/remix/route"},resolvedPagePath:"C:\\Coding Projects\\coaching-animator\\app\\api\\animations\\[id]\\remix\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:x,serverHooks:f}=m,_="/api/animations/[id]/remix/route";function g(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},9178:(e,t,a)=>{a.d(t,{Mq:()=>d,PR:()=>i,f1:()=>c,kF:()=>o,mk:()=>s});var n=a(9692),r=a(7070);async function i(){let e=await (0,n.j)(),{data:{user:t}}=await e.auth.getUser();return t}async function s(){return await i()||r.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401})}async function o(){let e=await i();if(!e)return r.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("role").eq("id",e.id).single();return a?.role!=="admin"?r.NextResponse.json({error:{code:"FORBIDDEN",message:"Admin access required"}},{status:403}):e}function c(e){return e instanceof r.NextResponse}async function u(e){let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("banned_at, ban_reason").eq("id",e).single();return a?.banned_at?{banned:!0,reason:a.ban_reason||"Account suspended"}:{banned:!1}}async function d(e){let t=await u(e);return t.banned?r.NextResponse.json({error:{code:"ACCOUNT_BANNED",message:t.reason||"Your account has been suspended"}},{status:403}):null}},639:(e,t,a)=>{a.d(t,{Wm:()=>r});var n=a(9692);async function r(e){let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("animation_count").eq("id",e).single(),r=a?.animation_count??0;return{allowed:r<50,current:r,max:50}}},9692:(e,t,a)=>{a.d(t,{j:()=>i});var n=a(2728),r=a(1615);async function i(){let e=await (0,r.cookies)();return(0,n.createServerClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:a,options:n})=>e.set(t,a,n))}catch{}}}})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[948,637,972],()=>a(2047));module.exports=n})();