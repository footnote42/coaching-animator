"use strict";(()=>{var e={};e.id=879,e.ids=[879],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5974:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>_,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{POST:()=>c});var s=r(9303),a=r(8716),o=r(670),i=r(7070),u=r(9692),d=r(9178);async function c(e,{params:t}){let r,n;let{id:s}=await t,a=await (0,d.mk)();if((0,d.f1)(a))return a;let o=await (0,u.j)(),{data:c,error:p}=await o.from("saved_animations").select("id, user_id, visibility, upvote_count").eq("id",s).is("hidden_at",null).single();if(p||!c)return i.NextResponse.json({error:{code:"NOT_FOUND",message:"Animation not found"}},{status:404});if(c.user_id===a.id)return i.NextResponse.json({error:{code:"BAD_REQUEST",message:"Cannot upvote your own animation"}},{status:400});if("private"===c.visibility)return i.NextResponse.json({error:{code:"NOT_FOUND",message:"Animation not found"}},{status:404});let{data:l}=await o.from("upvotes").select("user_id").eq("animation_id",s).eq("user_id",a.id).single();if(l){let{error:e}=await o.from("upvotes").delete().eq("animation_id",s).eq("user_id",a.id);if(e)return console.error("Upvote delete error:",e),i.NextResponse.json({error:{code:"DB_ERROR",message:`Failed to remove upvote: ${e.message}`}},{status:500});r=!1,n=Math.max(0,c.upvote_count-1)}else{let{error:e}=await o.from("upvotes").insert({animation_id:s,user_id:a.id});if(e)return console.error("Upvote insert error:",e),i.NextResponse.json({error:{code:"DB_ERROR",message:`Failed to add upvote: ${e.message}`}},{status:500});r=!0,n=c.upvote_count+1}return i.NextResponse.json({upvoted:r,upvote_count:n})}let p=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/animations/[id]/upvote/route",pathname:"/api/animations/[id]/upvote",filename:"route",bundlePath:"app/api/animations/[id]/upvote/route"},resolvedPagePath:"C:\\Coding Projects\\coaching-animator\\app\\api\\animations\\[id]\\upvote\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:v}=p,f="/api/animations/[id]/upvote/route";function _(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},9178:(e,t,r)=>{r.d(t,{Mq:()=>c,PR:()=>a,f1:()=>u,kF:()=>i,mk:()=>o});var n=r(9692),s=r(7070);async function a(){let e=await (0,n.j)(),{data:{user:t}}=await e.auth.getUser();return t}async function o(){return await a()||s.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401})}async function i(){let e=await a();if(!e)return s.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let t=await (0,n.j)(),{data:r}=await t.from("user_profiles").select("role").eq("id",e.id).single();return r?.role!=="admin"?s.NextResponse.json({error:{code:"FORBIDDEN",message:"Admin access required"}},{status:403}):e}function u(e){return e instanceof s.NextResponse}async function d(e){let t=await (0,n.j)(),{data:r}=await t.from("user_profiles").select("banned_at, ban_reason").eq("id",e).single();return r?.banned_at?{banned:!0,reason:r.ban_reason||"Account suspended"}:{banned:!1}}async function c(e){let t=await d(e);return t.banned?s.NextResponse.json({error:{code:"ACCOUNT_BANNED",message:t.reason||"Your account has been suspended"}},{status:403}):null}},9692:(e,t,r)=>{r.d(t,{j:()=>a});var n=r(2728),s=r(1615);async function a(){let e=await (0,s.cookies)();return(0,n.createServerClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:n})=>e.set(t,r,n))}catch{}}}})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,637,972],()=>r(5974));module.exports=n})();