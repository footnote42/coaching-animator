"use strict";(()=>{var e={};e.id=608,e.ids=[608],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9240:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v});var s={};a.r(s),a.d(s,{DELETE:()=>_,GET:()=>p,PUT:()=>m});var n=a(9303),i=a(8716),o=a(670),r=a(7070),d=a(9692),u=a(9178),c=a(2521),l=a(4954);async function p(e,{params:t}){let{id:a}=await t,s=await (0,u.PR)(),n=await (0,d.j)(),{data:i,error:o}=await n.from("saved_animations").select(`
      *,
      user_profiles!saved_animations_user_id_fkey (
        display_name
      )
    `).eq("id",a).is("hidden_at",null).single();if(o||!i)return r.NextResponse.json({error:{code:"NOT_FOUND",message:"Animation not found"}},{status:404});let c=s?.id===i.user_id,l="public"===i.visibility,p="link_shared"===i.visibility;if(!c&&!l&&!p)return r.NextResponse.json({error:{code:"UNAUTHORIZED",message:"You do not have access to this animation"}},{status:401});let m=!1;if(s){let{data:e}=await n.from("upvotes").select("user_id").eq("animation_id",a).eq("user_id",s.id).single();m=!!e}return c||await n.from("saved_animations").update({view_count:i.view_count+1}).eq("id",a),r.NextResponse.json({...i,author:{display_name:i.user_profiles?.display_name??null},user_has_upvoted:m,is_owner:c,user_profiles:void 0})}async function m(e,{params:t}){let a;let{id:s}=await t,n=await (0,u.mk)();if((0,u.f1)(n))return n;let i=await (0,u.Mq)(n.id);if(i)return i;let o=await (0,d.j)(),{data:p,error:m}=await o.from("saved_animations").select("user_id").eq("id",s).single();if(m||!p)return r.NextResponse.json({error:{code:"NOT_FOUND",message:"Animation not found"}},{status:404});if(p.user_id!==n.id)return r.NextResponse.json({error:{code:"FORBIDDEN",message:"You do not own this animation"}},{status:403});try{a=await e.json()}catch{return r.NextResponse.json({error:{code:"INVALID_JSON",message:"Invalid JSON body"}},{status:400})}let _=c.Zz.safeParse(a);if(!_.success)return r.NextResponse.json({error:{code:"VALIDATION_ERROR",message:_.error.message}},{status:400});let g=_.data;if(g.title||g.description||g.coaching_notes){let e=(0,l.e)({title:g.title,description:g.description,coaching_notes:g.coaching_notes});if(!e.passed)return r.NextResponse.json({error:{code:"CONTENT_VIOLATION",message:`Content contains inappropriate language: ${e.flaggedWords.join(", ")}`}},{status:400})}let f={updated_at:new Date().toISOString()};void 0!==g.title&&(f.title=g.title),void 0!==g.description&&(f.description=g.description),void 0!==g.coaching_notes&&(f.coaching_notes=g.coaching_notes),void 0!==g.animation_type&&(f.animation_type=g.animation_type),void 0!==g.tags&&(f.tags=g.tags),void 0!==g.visibility&&(f.visibility=g.visibility),void 0!==g.payload&&(f.payload=g.payload,f.frame_count=g.payload.frames?.length??0,f.duration_ms=g.payload.frames?.reduce((e,t)=>e+(t.duration??1e3),0)??0);let{data:v,error:x}=await o.from("saved_animations").update(f).eq("id",s).select("id, updated_at").single();return x?(console.error("Database error:",x),r.NextResponse.json({error:{code:"DB_ERROR",message:"Failed to update animation"}},{status:500})):r.NextResponse.json(v)}async function _(e,{params:t}){let{id:a}=await t,s=await (0,u.mk)();if((0,u.f1)(s))return s;let n=await (0,d.j)(),{data:i,error:o}=await n.from("saved_animations").select("user_id").eq("id",a).single();if(o||!i)return r.NextResponse.json({error:{code:"NOT_FOUND",message:"Animation not found"}},{status:404});if(i.user_id!==s.id)return r.NextResponse.json({error:{code:"FORBIDDEN",message:"You do not own this animation"}},{status:403});let{error:c}=await n.from("saved_animations").delete().eq("id",a);return c?(console.error("Database error:",c),r.NextResponse.json({error:{code:"DB_ERROR",message:"Failed to delete animation"}},{status:500})):new r.NextResponse(null,{status:204})}let g=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/animations/[id]/route",pathname:"/api/animations/[id]",filename:"route",bundlePath:"app/api/animations/[id]/route"},resolvedPagePath:"C:\\Coding Projects\\coaching-animator\\app\\api\\animations\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:v,serverHooks:x}=g,h="/api/animations/[id]/route";function y(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}},9178:(e,t,a)=>{a.d(t,{Mq:()=>c,PR:()=>i,f1:()=>d,kF:()=>r,mk:()=>o});var s=a(9692),n=a(7070);async function i(){let e=await (0,s.j)(),{data:{user:t}}=await e.auth.getUser();return t}async function o(){return await i()||n.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401})}async function r(){let e=await i();if(!e)return n.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let t=await (0,s.j)(),{data:a}=await t.from("user_profiles").select("role").eq("id",e.id).single();return a?.role!=="admin"?n.NextResponse.json({error:{code:"FORBIDDEN",message:"Admin access required"}},{status:403}):e}function d(e){return e instanceof n.NextResponse}async function u(e){let t=await (0,s.j)(),{data:a}=await t.from("user_profiles").select("banned_at, ban_reason").eq("id",e).single();return a?.banned_at?{banned:!0,reason:a.ban_reason||"Account suspended"}:{banned:!1}}async function c(e){let t=await u(e);return t.banned?n.NextResponse.json({error:{code:"ACCOUNT_BANNED",message:t.reason||"Your account has been suspended"}},{status:403}):null}},4954:(e,t,a)=>{a.d(t,{e:()=>n});let s=RegExp("\\\b(fuck|shit|ass|bitch|damn|crap|piss|dick|cock|pussy|asshole|bastard|slut|whore|nigger|faggot|retard|cunt)\\\b","gi");function n(e){return function(e){if(!e)return{passed:!0,flaggedWords:[]};let t=e.match(s);return t&&t.length>0?{passed:!1,flaggedWords:[...new Set(t.map(e=>e.toLowerCase()))]}:{passed:!0,flaggedWords:[]}}([e.title??"",e.description??"",e.coaching_notes??""].join(" "))}},2521:(e,t,a)=>{a.d(t,{Cm:()=>r,Gd:()=>l,ZO:()=>u,Zz:()=>d,p7:()=>p});var s=a(6543);let n=s.KmV(["tactic","skill","game","other"]),i=s.KmV(["private","link_shared","public"]),o=s.KmV(["inappropriate","spam","copyright","other"]),r=s.Ryn({title:s.Z_8().min(1).max(100),description:s.Z_8().max(2e3).optional(),coaching_notes:s.Z_8().max(5e3).optional(),animation_type:n,tags:s.IXX(s.Z_8().max(30)).max(10).optional(),payload:s.Ryn({version:s.Z_8(),name:s.Z_8(),sport:s.Z_8(),frames:s.IXX(s.YjB()),settings:s.Ryn({}).passthrough()}),visibility:i.optional().default("private")}),d=r.partial(),u=s.Ryn({animation_id:s.Z_8().uuid(),reason:o,details:s.Z_8().max(500).optional()}),c=s.Ryn({limit:s.oQ2.number().min(1).max(50).default(20),offset:s.oQ2.number().min(0).default(0)}),l=c.extend({q:s.Z_8().optional(),type:n.optional(),tags:s.Z_8().optional(),sort:s.KmV(["created_at","upvote_count"]).default("created_at"),order:s.KmV(["asc","desc"]).default("desc")}),p=c.extend({sort:s.KmV(["title","created_at","duration_ms","animation_type"]).default("created_at"),order:s.KmV(["asc","desc"]).default("desc")})},9692:(e,t,a)=>{a.d(t,{j:()=>i});var s=a(2728),n=a(1615);async function i(){let e=await (0,n.cookies)();return(0,s.createServerClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:a,options:s})=>e.set(t,a,s))}catch{}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[948,637,972,543],()=>a(9240));module.exports=s})();