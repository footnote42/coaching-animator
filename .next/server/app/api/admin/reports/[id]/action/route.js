"use strict";(()=>{var e={};e.id=504,e.ids=[504],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8196:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>R,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>N});var s={};t.r(s),t.d(s,{POST:()=>l});var n=t(9303),a=t(8716),o=t(670),i=t(7070),d=t(9178),u=t(9692),c=t(6543);let p=c.Ryn({action:c.KmV(["dismiss","hide","delete","warn_user","ban_user"]),reason:c.Z_8().max(500).optional()});async function l(e,{params:r}){let t;let s=await (0,d.kF)();if((0,d.f1)(s))return s;let{id:n}=await r;try{t=await e.json()}catch{return i.NextResponse.json({error:{code:"INVALID_JSON",message:"Invalid JSON body"}},{status:400})}let a=p.safeParse(t);if(!a.success)return i.NextResponse.json({error:{code:"VALIDATION_ERROR",message:a.error.message}},{status:400});let{action:o,reason:c}=a.data;if(["hide","warn_user","ban_user"].includes(o)&&!c)return i.NextResponse.json({error:{code:"REASON_REQUIRED",message:"Reason is required for this action"}},{status:400});let l=await (0,u.j)(),{data:m,error:_}=await l.from("content_reports").select(`
      id,
      status,
      animation_id,
      animation:saved_animations!animation_id (
        id,
        user_id
      )
    `).eq("id",n).single();if(_||!m)return i.NextResponse.json({error:{code:"NOT_FOUND",message:"Report not found"}},{status:404});if("pending"!==m.status)return i.NextResponse.json({error:{code:"ALREADY_PROCESSED",message:"Report has already been processed"}},{status:400});let N=m.animation,g=Array.isArray(N)?N[0]:N,f="dismiss"===o?"dismissed":"reviewed";try{switch(o){case"dismiss":break;case"hide":if(!g)return i.NextResponse.json({error:{code:"ANIMATION_NOT_FOUND",message:"Animation not found"}},{status:404});let{error:e}=await l.from("saved_animations").update({hidden_at:new Date().toISOString()}).eq("id",g.id);if(e)return console.error("Hide animation error:",e),i.NextResponse.json({error:{code:"ACTION_FAILED",message:"Failed to hide animation"}},{status:500});break;case"delete":if(!g)return i.NextResponse.json({error:{code:"ANIMATION_NOT_FOUND",message:"Animation not found"}},{status:404});let{error:r}=await l.from("saved_animations").delete().eq("id",g.id);if(r)return console.error("Delete animation error:",r),i.NextResponse.json({error:{code:"ACTION_FAILED",message:"Failed to delete animation"}},{status:500});break;case"warn_user":if(!g?.user_id)return i.NextResponse.json({error:{code:"USER_NOT_FOUND",message:"Animation owner not found"}},{status:404});let{error:t}=await l.rpc("increment_user_warnings",{target_user_id:g.user_id});t&&(console.log("Warning via RPC failed, trying direct update"),console.log(`Warning issued to user ${g.user_id}: ${c}`));break;case"ban_user":if(!g?.user_id)return i.NextResponse.json({error:{code:"USER_NOT_FOUND",message:"Animation owner not found"}},{status:404});let{error:a}=await l.from("user_profiles").update({banned_at:new Date().toISOString()}).eq("id",g.user_id);if(a)return console.error("Ban user error:",a),i.NextResponse.json({error:{code:"ACTION_FAILED",message:"Failed to ban user"}},{status:500})}let{error:d}=await l.from("content_reports").update({status:f,reviewed_by:s.id,reviewed_at:new Date().toISOString(),admin_notes:c||null}).eq("id",n);if(d)return console.error("Update report status error:",d),i.NextResponse.json({error:{code:"UPDATE_FAILED",message:"Failed to update report status"}},{status:500});return i.NextResponse.json({report_id:n,status:f,action_taken:o})}catch(e){return console.error("Admin action error:",e),i.NextResponse.json({error:{code:"INTERNAL_ERROR",message:"An unexpected error occurred"}},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/reports/[id]/action/route",pathname:"/api/admin/reports/[id]/action",filename:"route",bundlePath:"app/api/admin/reports/[id]/action/route"},resolvedPagePath:"C:\\Coding Projects\\coaching-animator\\app\\api\\admin\\reports\\[id]\\action\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:_,staticGenerationAsyncStorage:N,serverHooks:g}=m,f="/api/admin/reports/[id]/action/route";function R(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:N})}},9178:(e,r,t)=>{t.d(r,{Mq:()=>c,PR:()=>a,f1:()=>d,kF:()=>i,mk:()=>o});var s=t(9692),n=t(7070);async function a(){let e=await (0,s.j)(),{data:{user:r}}=await e.auth.getUser();return r}async function o(){return await a()||n.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401})}async function i(){let e=await a();if(!e)return n.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let r=await (0,s.j)(),{data:t}=await r.from("user_profiles").select("role").eq("id",e.id).single();return t?.role!=="admin"?n.NextResponse.json({error:{code:"FORBIDDEN",message:"Admin access required"}},{status:403}):e}function d(e){return e instanceof n.NextResponse}async function u(e){let r=await (0,s.j)(),{data:t}=await r.from("user_profiles").select("banned_at, ban_reason").eq("id",e).single();return t?.banned_at?{banned:!0,reason:t.ban_reason||"Account suspended"}:{banned:!1}}async function c(e){let r=await u(e);return r.banned?n.NextResponse.json({error:{code:"ACCOUNT_BANNED",message:r.reason||"Your account has been suspended"}},{status:403}):null}},9692:(e,r,t)=>{t.d(r,{j:()=>a});var s=t(2728),n=t(1615);async function a(){let e=await (0,n.cookies)();return(0,s.createServerClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:s})=>e.set(r,t,s))}catch{}}}})}}};var r=require("../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,637,972,543],()=>t(8196));module.exports=s})();