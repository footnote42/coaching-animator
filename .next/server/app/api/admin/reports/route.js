"use strict";(()=>{var e={};e.id=529,e.ids=[529],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7786:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>x,patchFetch:()=>h,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>_});var r={};a.r(r),a.d(r,{GET:()=>p});var n=a(9303),s=a(8716),i=a(670),o=a(7070),d=a(9178),u=a(9692),c=a(6543);let l=c.Ryn({status:c.KmV(["pending","reviewed","dismissed"]).default("pending"),limit:c.oQ2.number().min(1).max(50).default(20),offset:c.oQ2.number().min(0).default(0)});async function p(e){let t=await (0,d.kF)();if((0,d.f1)(t))return t;let a=Object.fromEntries(e.nextUrl.searchParams),r=l.safeParse(a);if(!r.success)return o.NextResponse.json({error:{code:"INVALID_PARAMS",message:r.error.message}},{status:400});let n=await (0,u.j)(),{data:s,error:i,count:c}=await n.from("content_reports").select(`
      id,
      reason,
      details,
      status,
      created_at,
      animation:saved_animations!animation_id (
        id,
        title,
        user_id
      ),
      reporter:user_profiles!reporter_id (
        id,
        display_name
      )
    `,{count:"exact"}).eq("status",r.data.status).order("created_at",{ascending:!1}).range(r.data.offset,r.data.offset+r.data.limit-1);if(i)return console.error("Admin reports fetch error:",i),o.NextResponse.json({error:{code:"DB_ERROR",message:"Failed to fetch reports"}},{status:500});let p=(s||[]).map(e=>(e.animation?.user_id,{id:e.id,animation:e.animation?{id:e.animation.id,title:e.animation.title,user_id:e.animation.user_id,author_display_name:null}:null,reporter:e.reporter?{id:e.reporter.id,display_name:e.reporter.display_name}:null,reason:e.reason,details:e.details,status:e.status,created_at:e.created_at})),m=[...new Set(p.filter(e=>e.animation?.user_id).map(e=>e.animation.user_id))];if(m.length>0){let{data:e}=await n.from("user_profiles").select("id, display_name").in("id",m),t=new Map(e?.map(e=>[e.id,e.display_name])||[]);p.forEach(e=>{e.animation?.user_id&&(e.animation.author_display_name=t.get(e.animation.user_id)||null)})}return o.NextResponse.json({reports:p,total:c??0})}let m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/reports/route",pathname:"/api/admin/reports",filename:"route",bundlePath:"app/api/admin/reports/route"},resolvedPagePath:"C:\\Coding Projects\\coaching-animator\\app\\api\\admin\\reports\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:_,serverHooks:g}=m,x="/api/admin/reports/route";function h(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:_})}},9178:(e,t,a)=>{a.d(t,{Mq:()=>c,PR:()=>s,f1:()=>d,kF:()=>o,mk:()=>i});var r=a(9692),n=a(7070);async function s(){let e=await (0,r.j)(),{data:{user:t}}=await e.auth.getUser();return t}async function i(){return await s()||n.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401})}async function o(){let e=await s();if(!e)return n.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let t=await (0,r.j)(),{data:a}=await t.from("user_profiles").select("role").eq("id",e.id).single();return a?.role!=="admin"?n.NextResponse.json({error:{code:"FORBIDDEN",message:"Admin access required"}},{status:403}):e}function d(e){return e instanceof n.NextResponse}async function u(e){let t=await (0,r.j)(),{data:a}=await t.from("user_profiles").select("banned_at, ban_reason").eq("id",e).single();return a?.banned_at?{banned:!0,reason:a.ban_reason||"Account suspended"}:{banned:!1}}async function c(e){let t=await u(e);return t.banned?n.NextResponse.json({error:{code:"ACCOUNT_BANNED",message:t.reason||"Your account has been suspended"}},{status:403}):null}},9692:(e,t,a)=>{a.d(t,{j:()=>s});var r=a(2728),n=a(1615);async function s(){let e=await (0,n.cookies)();return(0,r.createServerClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:a,options:r})=>e.set(t,a,r))}catch{}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,637,972,543],()=>a(7786));module.exports=r})();