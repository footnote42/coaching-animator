"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1439:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>j,patchFetch:()=>b,requestAsyncStorage:()=>x,routeModule:()=>f,serverHooks:()=>R,staticGenerationAsyncStorage:()=>g});var n={};a.r(n),a.d(n,{GET:()=>m,PUT:()=>_});var r=a(9303),s=a(8716),o=a(670),i=a(7070),u=a(9692),d=a(9178),l=a(6543);let c=l.Ryn({display_name:l.Z_8().max(50).optional().nullable()}),p=l.KmV(["user","admin"]);async function m(){let e=await (0,d.mk)();if((0,d.f1)(e))return e;let t=await (0,u.j)(),{data:a,error:n}=await t.from("user_profiles").select("id, display_name, animation_count, role, created_at").eq("id",e.id).single();return n||!a?i.NextResponse.json({error:{code:"NOT_FOUND",message:"Profile not found"}},{status:404}):i.NextResponse.json({...a,email:e.email})}async function _(e){let t;let a=await (0,d.mk)();if((0,d.f1)(a))return a;try{t=await e.json()}catch{return i.NextResponse.json({error:{code:"INVALID_JSON",message:"Invalid JSON body"}},{status:400})}let n=c.safeParse(t);if(!n.success)return i.NextResponse.json({error:{code:"VALIDATION_ERROR",message:n.error.message}},{status:400});let r=await (0,u.j)(),{data:s,error:o}=await r.from("user_profiles").update({display_name:n.data.display_name,updated_at:new Date().toISOString()}).eq("id",a.id).select("id, display_name, updated_at").single();return o?(console.error("Database error:",o),i.NextResponse.json({error:{code:"DB_ERROR",message:"Failed to update profile"}},{status:500})):i.NextResponse.json(s)}l.Ryn({id:l.Z_8().uuid(),display_name:l.Z_8().max(50).nullable(),animation_count:l.Rxh().int().min(0),role:p,banned_at:l.Z_8().nullable(),ban_reason:l.Z_8().nullable(),created_at:l.Z_8(),updated_at:l.Z_8()}),l.Ryn({action:l.KmV(["dismiss","hide","delete","warn_user","ban_user"]),reason:l.Z_8().max(500).optional()});let f=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/user/profile/route",pathname:"/api/user/profile",filename:"route",bundlePath:"app/api/user/profile/route"},resolvedPagePath:"C:\\Coding Projects\\coaching-animator\\app\\api\\user\\profile\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:x,staticGenerationAsyncStorage:g,serverHooks:R}=f,j="/api/user/profile/route";function b(){return(0,o.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:g})}},9178:(e,t,a)=>{a.d(t,{Mq:()=>l,PR:()=>s,f1:()=>u,kF:()=>i,mk:()=>o});var n=a(9692),r=a(7070);async function s(){let e=await (0,n.j)(),{data:{user:t}}=await e.auth.getUser();return t}async function o(){return await s()||r.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401})}async function i(){let e=await s();if(!e)return r.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("role").eq("id",e.id).single();return a?.role!=="admin"?r.NextResponse.json({error:{code:"FORBIDDEN",message:"Admin access required"}},{status:403}):e}function u(e){return e instanceof r.NextResponse}async function d(e){let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("banned_at, ban_reason").eq("id",e).single();return a?.banned_at?{banned:!0,reason:a.ban_reason||"Account suspended"}:{banned:!1}}async function l(e){let t=await d(e);return t.banned?r.NextResponse.json({error:{code:"ACCOUNT_BANNED",message:t.reason||"Your account has been suspended"}},{status:403}):null}},9692:(e,t,a)=>{a.d(t,{j:()=>s});var n=a(2728),r=a(1615);async function s(){let e=await (0,r.cookies)();return(0,n.createServerClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:a,options:n})=>e.set(t,a,n))}catch{}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[948,637,972,543],()=>a(1439));module.exports=n})();