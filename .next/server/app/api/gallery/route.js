"use strict";(()=>{var e={};e.id=936,e.ids=[936],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2060:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>_});var n={};a.r(n),a.d(n,{GET:()=>c});var r=a(9303),i=a(8716),s=a(670),o=a(7070),d=a(9692),l=a(9178),u=a(2521);async function c(e){let t=Object.fromEntries(e.nextUrl.searchParams),a=u.Gd.safeParse(t);if(!a.success)return o.NextResponse.json({error:{code:"INVALID_PARAMS",message:a.error.message}},{status:400});let{q:n,type:r,tags:i,sort:s,order:c,limit:p,offset:m}=a.data,_=await (0,l.PR)(),g=await (0,d.j)(),f=g.from("saved_animations").select(`
      id,
      title,
      description,
      animation_type,
      tags,
      duration_ms,
      frame_count,
      upvote_count,
      created_at,
      user_id
    `,{count:"exact"}).eq("visibility","public").is("hidden_at",null);if(n&&(f=f.or(`title.ilike.%${n}%,description.ilike.%${n}%`)),r&&(f=f.eq("animation_type",r)),i){let e=i.split(",").map(e=>e.trim()).filter(Boolean);e.length>0&&(f=f.overlaps("tags",e))}f=(f=f.order(s,{ascending:"asc"===c})).range(m,m+p-1);let{data:x,error:y,count:h}=await f;if(y)return console.error("Database error:",y),o.NextResponse.json({error:{code:"DB_ERROR",message:"Failed to fetch gallery"}},{status:500});let v=new Set;if(_&&x&&x.length>0){let e=x.map(e=>e.id),{data:t}=await g.from("upvotes").select("animation_id").eq("user_id",_.id).in("animation_id",e);v=new Set(t?.map(e=>e.animation_id)||[])}let R=new Map;if(x&&x.length>0){let e=[...new Set(x.map(e=>e.user_id))],{data:t}=await g.from("user_profiles").select("id, display_name").in("id",e);t?.forEach(e=>R.set(e.id,e.display_name))}let b=x?.map(e=>({id:e.id,title:e.title,description:e.description,animation_type:e.animation_type,tags:e.tags,duration_ms:e.duration_ms,frame_count:e.frame_count,upvote_count:e.upvote_count,created_at:e.created_at,user_id:e.user_id,author:{display_name:R.get(e.user_id)??null},user_has_upvoted:v.has(e.id)}))||[];return o.NextResponse.json({animations:b,total:h??0,limit:p,offset:m})}let p=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/gallery/route",pathname:"/api/gallery",filename:"route",bundlePath:"app/api/gallery/route"},resolvedPagePath:"C:\\Coding Projects\\coaching-animator\\app\\api\\gallery\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:_,serverHooks:g}=p,f="/api/gallery/route";function x(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:_})}},9178:(e,t,a)=>{a.d(t,{Mq:()=>u,PR:()=>i,f1:()=>d,kF:()=>o,mk:()=>s});var n=a(9692),r=a(7070);async function i(){let e=await (0,n.j)(),{data:{user:t}}=await e.auth.getUser();return t}async function s(){return await i()||r.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401})}async function o(){let e=await i();if(!e)return r.NextResponse.json({error:{code:"UNAUTHORIZED",message:"Authentication required"}},{status:401});let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("role").eq("id",e.id).single();return a?.role!=="admin"?r.NextResponse.json({error:{code:"FORBIDDEN",message:"Admin access required"}},{status:403}):e}function d(e){return e instanceof r.NextResponse}async function l(e){let t=await (0,n.j)(),{data:a}=await t.from("user_profiles").select("banned_at, ban_reason").eq("id",e).single();return a?.banned_at?{banned:!0,reason:a.ban_reason||"Account suspended"}:{banned:!1}}async function u(e){let t=await l(e);return t.banned?r.NextResponse.json({error:{code:"ACCOUNT_BANNED",message:t.reason||"Your account has been suspended"}},{status:403}):null}},2521:(e,t,a)=>{a.d(t,{Cm:()=>o,Gd:()=>c,ZO:()=>l,Zz:()=>d,p7:()=>p});var n=a(6543);let r=n.KmV(["tactic","skill","game","other"]),i=n.KmV(["private","link_shared","public"]),s=n.KmV(["inappropriate","spam","copyright","other"]),o=n.Ryn({title:n.Z_8().min(1).max(100),description:n.Z_8().max(2e3).optional(),coaching_notes:n.Z_8().max(5e3).optional(),animation_type:r,tags:n.IXX(n.Z_8().max(30)).max(10).optional(),payload:n.Ryn({version:n.Z_8(),name:n.Z_8(),sport:n.Z_8(),frames:n.IXX(n.YjB()),settings:n.Ryn({}).passthrough()}),visibility:i.optional().default("private")}),d=o.partial(),l=n.Ryn({animation_id:n.Z_8().uuid(),reason:s,details:n.Z_8().max(500).optional()}),u=n.Ryn({limit:n.oQ2.number().min(1).max(50).default(20),offset:n.oQ2.number().min(0).default(0)}),c=u.extend({q:n.Z_8().optional(),type:r.optional(),tags:n.Z_8().optional(),sort:n.KmV(["created_at","upvote_count"]).default("created_at"),order:n.KmV(["asc","desc"]).default("desc")}),p=u.extend({sort:n.KmV(["title","created_at","duration_ms","animation_type"]).default("created_at"),order:n.KmV(["asc","desc"]).default("desc")})},9692:(e,t,a)=>{a.d(t,{j:()=>i});var n=a(2728),r=a(1615);async function i(){let e=await (0,r.cookies)();return(0,n.createServerClient)("https://qwivksrxdvrcvuwzmbvr.supabase.co","sb_publishable_J07j1EdYOeUC_tbpoC7AQQ_cjGoXWdP",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:a,options:n})=>e.set(t,a,n))}catch{}}}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[948,637,972,543],()=>a(2060));module.exports=n})();